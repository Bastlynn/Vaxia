<?php
/**
 * @file
 * players.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function players_default_rules_configuration() {
  $items = array();
  $items['rules_returning_player_request_access'] = entity_import('rules_config', '{ "rules_returning_player_request_access" : {
      "LABEL" : "Cold storage - Returning player request access",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Cold storage" ],
      "REQUIRES" : [ "rules", "php", "views_rules", "webform_rules" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "11863" } } ],
      "DO" : [
        { "variable_add" : {
            "USING" : { "type" : "text", "value" : "[data:account_email-value]" },
            "PROVIDE" : { "variable_added" : { "account_email" : "Account email" } }
          }
        },
        { "data_set" : {
            "data" : [ "account-email" ],
            "value" : "\\u003C?php echo trim($account_email); ?\\u003E"
          }
        },
        { "drupal_message" : { "message" : "Looking up accounts for the email address \\u0022[data:account_email-value]\\u0022 ...." } },
        { "VIEW LOOP" : {
            "VIEW" : "cold_storage",
            "DISPLAY" : "cold_storage_retrieve",
            "USING" : { "mail" : [ "account-email" ] },
            "ROW VARIABLES" : { "uid" : { "uid" : "Uid" } },
            "DO" : [
              { "entity_query" : {
                  "USING" : {
                    "type" : "user",
                    "property" : "uid",
                    "value" : [ "uid" ],
                    "limit" : "1"
                  },
                  "PROVIDE" : { "entity_fetched" : { "found_account" : "Found Account" } }
                }
              },
              { "LOOP" : {
                  "USING" : { "list" : [ "found-account" ] },
                  "ITEM" : { "account" : "Account" },
                  "DO" : [
                    { "drupal_message" : { "message" : "Found account \\u0022[account:name]\\u0022 ... The account has been re-activated and a welcome email sent to the last email address associated with the account. Please check your spam and junk folders if you don\\u0027t see that email within the next 30 minutes! If you no longer have access to the old email address or can\\u0027t remember what the address was - please contact us at: http:\\/\\/vaxia.org\\/contact" } },
                    { "user_unblock" : { "account" : [ "account" ] } },
                    { "mail" : {
                        "to" : [ "account:mail" ],
                        "subject" : "[Vaxia] Account [account:name] Re-activated",
                        "message" : "We found your account ([account:name]) , and we were able to retrieve it from cold storage. Welcome back! Don\\u0027t forget to LOG IN with your account so that we don\\u0027t de-activate it again! If you\\u0027ve been gone from the site for a very long time, there are a few things you\\u0027ll want to take a look at to get caught up on. We have a page for all of that information here:\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/wiki\\/returning-players\\r\\n\\r\\nYour characters have been pulled out of cold storage but they will need to be re-evaluated to make sure they are up to date with the current System rules. Once you\\u0027re logged in you\\u0027ll find your characters here: http:\\/\\/vaxia.org\\/character-sheets\\/mine When you click on a character you\\u0027ll see the \\u0022Workflow\\u0022 tab, just set the character to submitted to get things started again! \\r\\n\\r\\nAlso, please drop by Limbo and say hi! We\\u0027ll be glad to help you get settled back in.\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/locations\\/limbo\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
                        "language" : [ "" ]
                      }
                    },
                    { "mail_to_users_of_role" : {
                        "roles" : { "value" : { "21" : "21" } },
                        "subject" : "[Vaxia] Account Reactivated From Cold Storage",
                        "message" : "A player has returned to Vaxia and reactivated their account from Cold Storage.\\r\\n\\r\\nPlease keep an eye on this player for a little bit, they may need some extra help to get settled in with all the recent changes.\\r\\n\\r\\nIf there is a critical reason why we should NOT let this player return bring it up as quickly as possible with the Leads.\\r\\n\\r\\nReturning player: [account:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        { "drupal_message" : { "message" : "Done searching. If your account was not found please make sure you\\u0027re using the right email address for it or contact us and we\\u0027ll go hunting for it." } }
      ]
    }
  }');
  return $items;
}
