<?php
/**
 * @file
 * players.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function players_default_rules_configuration() {
  $items = array();
  $items['rules_returning_player_request_access'] = entity_import('rules_config', '{ "rules_returning_player_request_access" : {
      "LABEL" : "Returning player request access",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Cold storage" ],
      "REQUIRES" : [ "rules", "php", "views_rules", "webform_rules" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "11863" } } ],
      "DO" : [
        { "variable_add" : {
            "USING" : { "type" : "text", "value" : "[data:account_email-value]" },
            "PROVIDE" : { "variable_added" : { "account_email" : "Account email" } }
          }
        },
        { "data_set" : {
            "data" : [ "account-email" ],
            "value" : "\\u003C?php echo trim($account_email); ?\\u003E"
          }
        },
        { "drupal_message" : { "message" : "Looking up accounts for the email address \\u0022[data:account_email-value]\\u0022 ...." } },
        { "VIEW LOOP" : {
            "VIEW" : "cold_storage",
            "DISPLAY" : "cold_storage_retrieve",
            "USING" : { "mail" : [ "account-email" ] },
            "ROW VARIABLES" : { "uid" : { "uid" : "Uid" } },
            "DO" : [
              { "entity_query" : {
                  "USING" : {
                    "type" : "user",
                    "property" : "uid",
                    "value" : [ "uid" ],
                    "limit" : "1"
                  },
                  "PROVIDE" : { "entity_fetched" : { "found_account" : "Found Account" } }
                }
              },
              { "LOOP" : {
                  "USING" : { "list" : [ "found-account" ] },
                  "ITEM" : { "account" : "Account" },
                  "DO" : [
                    { "drupal_message" : { "message" : "Found account \\u0022[account:name]\\u0022 ..." } },
                    { "user_unblock" : { "account" : [ "account" ] } },
                    { "mail" : {
                        "to" : [ "account:mail" ],
                        "subject" : "[Vaxia] Account Re-activated",
                        "message" : "Hello!\\r\\n\\r\\nWe found your account, and we were able to retrieve it from cold storage. Welcome back! Your characters are currently set to submitted so that our evaluators can give them a look over to make sure they are up to date.\\r\\n\\r\\nIf you\\u0027ve been gone from the site for a very long time, there are a few things you\\u0027ll want to take a look at to get caught up on.\\r\\n\\r\\na) We have a Site Governance agreement in place now - a constitution the site voted on to use for administration from here on out. This is a formal system designed to keep our leadership on an even-keel and empower players to have a say in the site.\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/proposals\\/site-governance\\r\\nhttp:\\/\\/vaxia.org\\/proposals\\/amendments\\r\\n\\r\\nb) We have three departments, Setting \\/ Social \\/ System. They do what it says on the tin. The departments have forums for posting in, and if you want to join one it\\u0027s as simple as taking one of our walk throughs and opting in.\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/quizzes\\/new-player-setting-walkthrough\\r\\nhttp:\\/\\/vaxia.org\\/quizzes\\/new-player-social-walkthrough\\r\\nhttp:\\/\\/vaxia.org\\/quizzes\\/new-player-system-walkthrough\\r\\n\\r\\nc) We have two settings nowadays: The same old Vaxia and a newer science fiction space setting Sirian. We recommend starting with Vaxia if it\\u0027s been awhile since that\\u0027s the one that it\\u0027s easier to settle back into.\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/wiki\\/vaxia-brief\\r\\nhttp:\\/\\/vaxia.org\\/wiki\\/brief-0\\r\\n\\r\\nPlease drop by Limbo and say hi!\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/locations\\/limbo\\r\\n\\r\\nAnd of course, if you have questions feel free to post on the forums or ask any of the department leads.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
                        "language" : [ "" ]
                      }
                    },
                    { "mail_to_users_of_role" : {
                        "roles" : { "value" : { "21" : "21" } },
                        "subject" : "[Vaxia] Account Reactivated From Cold Storage",
                        "message" : "A player has returned to Vaxia and reactivated their account from Cold Storage.\\r\\n\\r\\nPlease keep an eye on this player for a little bit, they may need some extra help to get settled in with all the recent changes.\\r\\n\\r\\nIf there is a critical reason why we should NOT let this player return bring it up as quickly as possible with the Leads.\\r\\n\\r\\nReturning player: [account:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    }
  }');
  return $items;
}
