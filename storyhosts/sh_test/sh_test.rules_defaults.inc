<?php
/**
 * @file
 * sh_test.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function sh_test_default_rules_configuration() {
  $items = array();
  $items['rules_response_sh_application'] = entity_import('rules_config', '{ "rules_response_sh_application" : {
      "LABEL" : "SH Test - Promote to Storyhost",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "php", "role_app", "webform_rules" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "application" : "application" } }
          }
        },
        { "node_is_of_type" : {
            "node" : [ "node:author:field-storyhost-character" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "NOT data_is_empty" : { "data" : [ "node:field-applied-role-id" ] } },
        { "data_is" : { "data" : [ "node:field-applied-role-id" ], "value" : "9" } },
        { "user_has_role" : {
            "account" : [ "node:author" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "17" : "17" } }
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_ash_3_approvals($node-\\u003Enid);" } },
        { "role_app_approved_app" : { "webform" : [ "node" ] } }
      ],
      "DO" : [
        { "webform_close" : { "entity" : [ "node" ], "selected_webform" : { "value" : [] } } },
        { "data_set" : {
            "data" : [ "node:author:field-storyhost-character:field-titles" ],
            "value" : "SH"
          }
        },
        { "user_remove_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "17" : "17" } } } },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "9" : "9" } } } },
        { "data_set" : { "data" : [ "node:author:field-took-ash1" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-took-ash2" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-took-ash3" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-became-sh" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-powers-expire" ], "value" : "+3 months" } },
        { "drupal_message" : { "message" : "SH Candidate [node:author:name] has received three approvals and has been promoted to a full Storyhost." } },
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] SH privileges granted",
            "message" : "You have been approved to join the Storyhost\\u0027s on Vaxia. Congratulations!\\r\\n\\r\\nWhen you next see other SH\\u0027s on site, please take a moment to see if any of their stories and your stories can fit together. If you have questions about your sessions, other SHs and World heads are available to answer any questions you may have.\\r\\n\\r\\nWe do ask Storyhosts to regularly run a session once every 3 months, this position is a working volunteer position to serve the needs of the site, so we do need you to fulfill the duties of that role. If you do take an unexpected extended vacation and lose your permissions as a Storyhost you will need to retrain in order to return to Storyhost position. If you know you need to take a vacation, check under your user account for the Vacation button.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "25" : "25" } },
            "subject" : "[Vaxia] New SH approved",
            "message" : "Storyhost Candidate [node:author:name] has been promoted to SH!\\r\\n\\r\\nYou are receiving this email because you are one of the Storyhosts or ASHs.\\r\\n\\r\\nPlease congratulate your new fellow SH when you see them next. Feel free to coordinate with each other if any of their stories and your stories can fit together.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~\\r\\n"
          }
        }
      ]
    }
  }');
  $items['rules_send_feedback_to_sh_from_webform'] = entity_import('rules_config', '{ "rules_send_feedback_to_sh_from_webform" : {
      "LABEL" : "SH Test - Send Feedback on Performance to ASH",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "9832" } },
        { "node_is_webform" : { "node" : [ "node" ] } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "9" : "9", "14" : "14", "21" : "21", "10" : "10", "17" : "17" } },
            "operation" : "OR"
          }
        }
      ],
      "DO" : [
        { "variable_add" : {
            "USING" : {
              "type" : "text",
              "value" : "\\u003C?php\\r\\n  $results = db_query(\\u0022SELECT wd.data FROM {webform_submitted_data} wd \\u0022 .\\r\\n    \\u0022WHERE wd.nid = 9832 AND wd.cid = 2 ORDER BY sid DESC LIMIT 0,1\\u0022);\\r\\n  foreach ($results as $result) {\\r\\n    return $result-\\u003Edata;\\r\\n  }\\r\\n  return \\u0027\\u0027;\\r\\n?\\u003E"
            },
            "PROVIDE" : { "variable_added" : { "storyhost_name" : "Storyhost name" } }
          }
        },
        { "entity_query" : {
            "USING" : {
              "type" : "user",
              "property" : "name",
              "value" : [ "storyhost-name" ],
              "limit" : "1"
            },
            "PROVIDE" : { "entity_fetched" : { "storyhost" : "Storyhost" } }
          }
        },
        { "mail" : {
            "to" : [ "storyhost:0:mail" ],
            "subject" : "[Vaxia] Storyhost feedback",
            "message" : "The following feedback was received for Storyhost [data:storyhost-value].\\r\\n\\r\\nSubmitted on [site:current-date]\\r\\n\\r\\nThe message we received was:\\r\\n\\r\\n[data:feedback-value]\\r\\n\\r\\nDo to the nature of the anonymous feedback form, we do not have contact information for this user. If the contents of the email are of legal concern such as a report of a crime under U.S. law or a credible threat, please forward the email to the technical administrator so the site owner may review IP logs and decide on a course of action.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "21" : "21" } },
            "subject" : "[Vaxia] Storyhost feedback",
            "message" : "The following feedback was received for Storyhost [data:storyhost-value].\\r\\n\\r\\nSubmitted on [site:current-date]\\r\\n\\r\\nThe message we received was:\\r\\n\\r\\n[data:feedback-value]\\r\\n\\r\\nDo to the nature of the anonymous feedback form, we do not have contact information for this user. If the contents of the email are of legal concern such as a report of a crime under U.S. law or a credible threat, please forward the email to the technical administrator so the site owner may review IP logs and decide on a course of action.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_1_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_1_mark_pass" : {
      "LABEL" : "SH Test - Record ASH 1 Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } } ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test One." } }
      ]
    }
  }');
  $items['rules_sh_test_1_response'] = entity_import('rules_config', '{ "rules_sh_test_1_response" : {
      "LABEL" : "SH Test - Promote to ASH 1",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "php", "workflow_rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "13" : "13", "10" : "10", "17" : "17", "9" : "9" } },
            "operation" : "OR"
          }
        }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] A new SH applicant has completed ASH Test One",
            "message" : "A player had passed ASH Test One!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run three sessions with an SH mentor on hand to handle the numbers within the next six  months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions. The new ASH does *not* have powers to view sheets or assign XP. The mentor will need to do that for them.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test One",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test One. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Two, you need to practice some of what you\\u0027ve learned so far. You must run three sessions with an SH mentor on hand to handle the numbers within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions, so please feel free to contact any of them to coordinate your sessions.\\r\\n\\r\\nOnce you are done with your three sessions, take ASH Test Two: http:\\/\\/vaxia.org\\/content\\/ash-test-2-ruling\\r\\n\\r\\nPlease review the responsibilities of an ASH 1 here: http:\\/\\/vaxia.org\\/wiki\\/system-rules\\/basics\\/ash-1-responsibilities\\r\\n\\r\\nWelcome aboard, we\\u0027re looking forward to working with you.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "workflow_rules_set_state" : {
            "node" : [ "user:field-storyhost-character" ],
            "workflow_state" : { "value" : { "4" : "4" } },
            "workflow_comment" : "Set Storyhost character - if exists - to approved on passing ASH 1"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_2_mark_pass" : {
      "LABEL" : "SH Test - Record ASH 2 Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "OR" : [
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7781" } }
          ]
        }
      ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash2" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test Two." } }
      ]
    }
  }');
  $items['rules_sh_test_2_response'] = entity_import('rules_config', '{ "rules_sh_test_2_response" : {
      "LABEL" : "SH Test - Promote to ASH 2",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "10" : "10", "17" : "17", "9" : "9" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_sessions_ran($user-\\u003Euid, 3);" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] An ASH has passed ASH Test Two",
            "message" : "A player had passed ASH Test Two!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run five sessions within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The new ASH has received ASH powers and may now view sheets.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test Two",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test Two. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Three, you need to practice some of what you\\u0027ve learned so far. You must run five sessions within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E.\\r\\n\\r\\nWith passing ASH Test Two you are now empowered with the ability to view sheets, assign XP and generally act as a direct SH. Do not abuse this power.\\r\\n\\r\\nPlease review the responsibilities of an ASH 2 here: http:\\/\\/vaxia.org\\/wiki\\/system-rules\\/ruling\\/ash-2-responsibilities\\r\\n\\r\\nAt any point between now and when you are done with your sessions you may take ASH Test Three: http:\\/\\/vaxia.org\\/quizzes\\/ash-test-3-evaluation\\r\\n\\r\\nOnce you are done with your five sessions, and have taken ASH Test Three, then you are ready for the Final Exam: http:\\/\\/vaxia.org\\/quizzes\\/ash-test-final-exam\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : {
                "3" : "3",
                "9" : "9",
                "14" : "14",
                "21" : "21",
                "10" : "10",
                "17" : "17"
              }
            },
            "subject" : "[Vaxia] [user:name] has passed ASH Test Two",
            "message" : "[user:name] has graduated from ASH 1 to ASH 2!\\r\\n\\r\\nThat means they are now ready to start working with the numbers and ruling on their own. This is also a great point in their development as a Storyhost to give them some feedback for things they should focus on in their next five sessions. Please take a moment to drop by this form to give your feedback. It is anonymous so that the new ASH won\\u0027t associate your feedback with you personally.\\r\\n\\r\\nThis sort of feedback is invaluable for their development as a Storyhost, so don\\u0027t forget to tell them what they\\u0027re doing right! That way they know to keep doing that in future sessions.\\r\\n\\r\\nFeedback form: http:\\/\\/vaxia.org\\/content\\/storyhost-feedback?storyhost=[user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_3_reminder_to_approvers'] = entity_import('rules_config', '{ "rules_sh_test_3_reminder_to_approvers" : {
      "LABEL" : "ADJUST: SH Test - Candidate Reminder",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "sh_test" ],
      "ON" : { "overdue_application" : [] },
      "IF" : [
        { "entity_is_of_bundle" : {
            "entity" : [ "node" ],
            "type" : "node",
            "bundle" : { "value" : { "storyhost_application" : "storyhost_application" } }
          }
        }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "25" : "25" } },
            "subject" : "[Vaxia]  An ASH application has been waiting for a week",
            "message" : "A player had passed ASH Test Three, and their application has not yet been approved by three eligible approvers. \\r\\n\\r\\nYou are receiving this email because you are one of the people available to approve new Storyhosts in regular or starvation mode. Three approvers must mark this application before it is accepted and the ASH promoted to SH.\\r\\n\\r\\nPlease take a look and evaluate if you believe this player is ready to become a full Storyhost. If they aren\\u0027t, please be ready to provide guidance and instruction to the ASH to resolve any lingering concerns. You will need to be specific about your concerns so the ASH can address them and improve on them.\\r\\n\\r\\nIf this ASH is not going to be able to pass on this application, then all eligible approvers need to weigh in on what the ASH can do to improve so they may work on weak points for the next application. This application will remain open until all approvers have provided feedback in order to provide the ASH with the greatest chance of passing on the next attempt.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nStoryhost Candidate: [node:author:name]\\r\\nApplication: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "entity_save" : { "data" : [ "node" ] } }
      ]
    }
  }');
  $items['sh_test_get_session_feedback_for_ash'] = entity_import('rules_config', '{ "sh_test_get_session_feedback_for_ash" : {
      "LABEL" : "SH Test - Get Player Feedback on Session",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_insert--session_report" : { "bundle" : "session_report" } },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "node:author" ],
            "roles" : { "value" : { "13" : "13", "10" : "10", "17" : "17" } },
            "operation" : "OR"
          }
        }
      ],
      "DO" : [
        { "LOOP" : {
            "USING" : { "list" : [ "node:field-characters-involved" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [
              { "mail" : {
                  "to" : [ "list-item:author:mail" ],
                  "subject" : "[Vaxia] [node:author:name] feedback requested!",
                  "message" : "[node:author:name] has submitted a new session report [node:title]. This is also a great point in their development as a Storyhost to give them some feedback for things they should focus on in their next session.\\r\\n\\r\\nPlease take a moment to drop by this form to give your feedback. It is anonymous, so that the new ASH won\\u0027t associate your feedback with you personally. The feedback will initially go to the leads so they can take a look at it for any trends. This sort of feedback is invaluable for their development as a Storyhost, so don\\u0027t forget to tell them what they\\u0027re doing right! That way they know to keep doing that in future sessions.\\r\\n\\r\\nWherever possible try to provide constructive criticism: http:\\/\\/en.wikipedia.org\\/wiki\\/Constructive_criticism\\r\\n\\r\\n* Focus on the work rather than than the person.\\r\\n* Make sure your critiques are clear, specific and detailed.\\r\\n* And absolutely make sure they are actionable - make sure these are things the A\\/SH can actually do something about.\\r\\n\\r\\nFeedback form: http:\\/\\/vaxia.org\\/content\\/session-feedback?storyhost=[node:author:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
                  "language" : [ "" ]
                }
              }
            ]
          }
        }
      ]
    }
  }');
  $items['sh_test_response_sh_application_all_reviewers_in'] = entity_import('rules_config', '{ "sh_test_response_sh_application_all_reviewers_in" : {
      "LABEL" : "ADJUST: SH Test - Candidate NOT Accepted",
      "PLUGIN" : "reaction rule",
      "WEIGHT" : "1",
      "ACTIVE" : false,
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "storyhost_application" : "storyhost_application" } }
          }
        },
        { "node_is_webform" : { "node" : [ "node" ] } },
        { "user_has_role" : {
            "account" : [ "node:author" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "17" : "17" } }
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_ash_3_responses($node-\\u003Enid);" } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] All current SH approvers have ruled on your application",
            "message" : "All current SH approvers have ruled on your application to join the Storyhosts.\\r\\n\\r\\nPlease take a moment to look at your application and review any responses you may have received. If you have questions about your sessions, other SHs and World heads are available to answer any questions you may have.\\r\\n\\r\\nApplication: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "25" : "25" } },
            "subject" : "[Vaxia] All current SH approvers have ruled on an ASH application",
            "message" : "All current SH approvers have ruled on an application to join the Storyhosts.\\r\\n\\r\\nPlease take a moment to look at the application and review any responses received if the ASH did not receive enough approvals to be promoted to Storyhost. The ASH should have been given specific guidance in order to improve so they may re-apply. If the guidance they have been given is not detailed enough to allow them to be able to pass on their second try, please consult with the reviewing Storyhost or ASH to determine what the applicant needs to do to pass on the next application.\\r\\n\\r\\nApplication: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~\\r\\n"
          }
        },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_remove_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "17" : "17" } } } },
        { "drupal_message" : { "message" : "The SH Candidate has been notified and sent a link to review the feedback given." } }
      ]
    }
  }');
  $items['sh_test_rules_sh_test_4_mark_pass'] = entity_import('rules_config', '{ "sh_test_rules_sh_test_4_mark_pass" : {
      "LABEL" : "SH Test - Record ASH 3 Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "9359" } } ],
      "DO" : [
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test Four \\/ Evaluation Test." } },
        { "data_set" : { "data" : [ "user:field-took-eval-test" ], "value" : "now" } }
      ]
    }
  }');
  $items['sh_test_send_session_feedback_to_sh_from_webform'] = entity_import('rules_config', '{ "sh_test_send_session_feedback_to_sh_from_webform" : {
      "LABEL" : "SH Test - Send Player Feedback on Session to Leads",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Course" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "9907" } },
        { "node_is_webform" : { "node" : [ "node" ] } },
        { "user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "8" : "8" } } } }
      ],
      "DO" : [
        { "variable_add" : {
            "USING" : {
              "type" : "text",
              "value" : "\\u003C?php\\r\\n  $results = db_query(\\u0022SELECT wd.data FROM {webform_submitted_data} wd \\u0022 .\\r\\n    \\u0022WHERE wd.nid = 9832 AND wd.cid = 2 ORDER BY sid DESC LIMIT 0,1\\u0022);\\r\\n  foreach ($results as $result) {\\r\\n    return $result-\\u003Edata;\\r\\n  }\\r\\n  return \\u0027\\u0027;\\r\\n?\\u003E"
            },
            "PROVIDE" : { "variable_added" : { "storyhost_name" : "Storyhost name" } }
          }
        },
        { "entity_query" : {
            "USING" : {
              "type" : "user",
              "property" : "name",
              "value" : [ "storyhost-name" ],
              "limit" : "1"
            },
            "PROVIDE" : { "entity_fetched" : { "storyhost" : "Storyhost" } }
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] Storyhost session feedback",
            "message" : "The following feedback was received for Storyhost [data:storyhost-value] based on their latest session report.\\r\\n\\r\\nSubmitted on [site:current-date]\\r\\n\\r\\nThe message we received was:\\r\\n\\r\\n[data:feedback-value]\\r\\n\\r\\n---\\r\\n\\r\\nNOTE: This email has NOT been forwarded to the ASH. This is to make sure a new ASH does not get irrelevant or abusive feedback as they are learning. The SH mentor for this session should compile the feedback, review for common trends, and forward the information to the ASH so they can get good guidance for the next session. We recommend emphasizing phrasing your feedback in the form of things \\u0022to do\\u0022 as opposed to things \\u0022not to do\\u0022. Positive and defined actions to take are much more useful to help an ASH improve their skills.\\r\\n\\r\\nDo to the nature of the anonymous feedback form, we do not have contact information for this user. If the contents of the email are of legal concern such as a report of a crime under U.S. law or a credible threat, please forward the email to the technical administrator so the site owner may review IP logs and decide on a course of action.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  return $items;
}
