<?php
/**
 * @file
 * rpg_site_staff.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function rpg_site_staff_default_rules_configuration() {
  $items = array();
  $items['rules_anonymous_mail'] = entity_import('rules_config', '{ "rules_anonymous_mail" : {
      "LABEL" : "Anonymous mail",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "webform_rules" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "9368" } } ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "21" : "21" } },
            "subject" : "[Vaxia] Anonymous email",
            "message" : "An anonymous email has been sent to the site heads. Please take a look at this message as soon as possible.\\r\\n\\r\\nSubmitted on [site:current-date]\\r\\n\\r\\nThe message we received was:\\r\\n\\r\\n[data:message-value]\\r\\n\\r\\nDo to the nature of the anonymous emailer, we do not have contact information for this user. If the contents of the email are of legal concern such as a report of a crime under U.S. law or a credible threat, please forward the email to the technical administrator so the site owner may review IP logs and decide on a course of action.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_rem_priv_roles_when_expired'] = entity_import('rules_config', '{ "rules_rem_priv_roles_when_expired" : {
      "LABEL" : "Rem priv roles when expired",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "15" : "15", "9" : "9", "20" : "20", "14" : "14", "21" : "21" } },
            "operation" : "OR"
          }
        },
        { "data_is" : {
            "data" : [ "user:field-powers-expire" ],
            "op" : "\\u003C",
            "value" : "now"
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : {
                "13" : "13",
                "10" : "10",
                "17" : "17",
                "15" : "15",
                "9" : "9",
                "20" : "20",
                "14" : "14",
                "21" : "21"
              }
            }
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14", "21" : "21" } },
            "subject" : "[Vaxia] [user:name] has lost administrative privileges",
            "message" : "[user:name] has not run required sessions or evaluated characters or items within the required timeframe and has lost all permissions above player as a result.\\r\\n\\r\\nYou are receiving this email because you share some of the same roles, and need to be aware of the changes. If this is a position that needs to be critically filled, please consult with other leadership on the site to recruit or nominate new members to this position as soon as possible.\\r\\n\\r\\nWhile we understand the need to prioritize life over game, we do need members in leadership positions to uphold their responsibilities. [user:name]\\u0027s loss of position due to absence does not preclude re-gaining the position upon return to the site - on the condition that the return is intended to be a long-term return. [user:name] may need to go through the SH course a second time to fully regain permissions.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "mail" : {
            "to" : "[user:mail]",
            "subject" : "[Vaxia] You have lost administrative privileges",
            "message" : "[user:name],\\r\\n\\r\\nDespite being listed as active, you have not run sessions or evaluated characters or items within the required timeframe.  As a result, you have automatically lost your privileges as a story host, and been reverted to the role of player.\\r\\n\\r\\nWhile we understand the need for everyone to prioritize life over game, we also need those in the role of evaluator to uphold their responsibilities, including but not limited to running sessions for the site. Your loss of position due to absence does not prevent you from re-gaining the position if and when you return to the site, provided you retake and again complete the SH course, including all tests and session requirements involved.\\r\\n\\r\\nIf you have any questions about the policies on inactive SHs, use the site\\u0027s Contact form or post to the Policies forum to get clarification.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_rem_sh_role_if_absentee_6mo'] = entity_import('rules_config', '{ "rules_rem_sh_role_if_absentee_6mo" : {
      "LABEL" : "Rem priv roles if absentee 6mo",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : {
                "13" : "13",
                "10" : "10",
                "17" : "17",
                "15" : "15",
                "9" : "9",
                "20" : "20",
                "14" : "14",
                "21" : "21"
              }
            },
            "operation" : "OR"
          }
        },
        { "data_is" : {
            "data" : [ "user:last-access" ],
            "op" : "\\u003C",
            "value" : "-6 months"
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : {
                "13" : "13",
                "10" : "10",
                "17" : "17",
                "15" : "15",
                "9" : "9",
                "20" : "20",
                "14" : "14",
                "21" : "21"
              }
            }
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] Administrative privileges lost ",
            "message" : "[user:name] has been absent from the site for 6 months, and has lost all permissions above player as a result.\\r\\n\\r\\nYou are receiving this email because you share some of the same roles, and need to be aware of the changes. If this is a position that needs to be critically filled, please consult with other leadership on the site to recruit or nominate new members to this position.\\r\\n\\r\\nWhile we understand the need to prioritize life over game, we do need members in leadership positions to uphold their responsibilities. [user:name]\\u0027s loss of position due to absence does not preclude re-gaining the position upon return to the site - on the condition that the return is intended to be a long-term return.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] Storyhost privileges lost ",
            "message" : "[user:name],\\r\\n\\r\\nDespite being listed as active, you have been completely absent from the site for six months without logging in.  As a result, you have automatically lost your privileges as a story host, and been reverted to the role of player.\\r\\n\\r\\nWhile we understand the need for everyone to prioritize life over game, we also need those in the role of SH to uphold their responsibilities, including but not limited to running sessions for the site. Your loss of position due to absence does not prevent you from re-gaining the position if and when you return to the site, provided you retake and again complete the ASH course, including all tests and session requirements involved therein.\\r\\n\\r\\nSHs aware of sustained absences from the site have the power to set themselves on \\u0022Vacation Mode\\u0022 via their account settings.  Doing so will temporarily suspend your permissions, but you can be reactivated at any time in the future through the same settings pane.\\r\\n\\r\\nIf you have any questions about the policies on inactive SHs, use the site\\u0027s Contact form or post to the Policies forum to get clarification.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_retire_inactive_user_account'] = entity_import('rules_config', '{ "rules_retire_inactive_user_account" : {
      "LABEL" : "Retire inactive user account",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Players" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "NOT user_is_blocked" : { "account" : [ "user" ] } },
        { "user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "8" : "8" } } } },
        { "data_is" : { "data" : [ "user:created" ], "op" : "\\u003C", "value" : "-1 year" } },
        { "data_is" : { "data" : [ "user:last-access" ], "op" : "\\u003C", "value" : "-1 year" } }
      ],
      "DO" : [
        { "user_remove_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : {
                "19" : "19",
                "13" : "13",
                "10" : "10",
                "17" : "17",
                "15" : "15",
                "9" : "9",
                "20" : "20",
                "14" : "14",
                "21" : "21",
                "4" : "4",
                "3" : "3",
                "11" : "11"
              }
            }
          }
        },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "22" : "22" } } } },
        { "entity_save" : { "data" : [ "user" ], "immediate" : 1 } },
        { "user_block" : { "account" : [ "user" ] } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] User has been set inactive",
            "message" : "The following user account has been set inactive.\\r\\n\\r\\n[user:name]\\r\\n\\r\\nThe user created the account and a character, but the player has not logged in since. The account has been moved to cold storage."
          }
        }
      ]
    }
  }');
  $items['rules_retire_unused_user_account'] = entity_import('rules_config', '{ "rules_retire_unused_user_account" : {
      "LABEL" : "Delete unused user account",
      "PLUGIN" : "reaction rule",
      "WEIGHT" : "1",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "NOT user_is_blocked" : { "account" : [ "user" ] } },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8" } },
            "operation" : "OR"
          }
        },
        { "data_is" : { "data" : [ "user:created" ], "op" : "\\u003C", "value" : "-3 days" } },
        { "data_is_empty" : { "data" : [ "user:last-login" ] } }
      ],
      "DO" : [
        { "entity_delete" : { "data" : [ "user" ] } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] User account deleted",
            "message" : "The following user account has been deleted.\\r\\n\\r\\n[user:name]\\r\\n\\r\\nThe user created the account, but did not create a character within the expected timeframe and has not logged in since. The account has been deleted as a likely spambot.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_user_is_of_minimal_age'] = entity_import('rules_config', '{ "rules_user_is_of_minimal_age" : {
      "LABEL" : "User is of minimal age",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "user_insert" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "account:field-age-requirement" ], "value" : 1 } }
      ],
      "DO" : [ { "user_unblock" : { "account" : [ "account" ] } } ]
    }
  }');
  $items['rules_user_is_under_minimal_age'] = entity_import('rules_config', '{ "rules_user_is_under_minimal_age" : {
      "LABEL" : "User is under minimal age",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "user_insert" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "account:field-age-requirement" ], "value" : 0 } }
      ],
      "DO" : [
        { "user_block" : { "account" : [ "account" ] } },
        { "mail" : {
            "to" : "[account:mail]",
            "subject" : "Account details for [user:name] at [site:name] (NOT approved)",
            "message" : "[user:name],\\r\\n\\r\\nThank you for your interest in [site:name]. Your application for an account has been denied because you are under 13.\\r\\n\\r\\nWe have a minimum age to play on the site. Please feel free to return when you\\u0027re 13, and we\\u0027ll be glad to have you!\\r\\n\\r\\n\\r\\n--  [site:name] team",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['vaxia_accounts_delete_non_player_user_account'] = entity_import('rules_config', '{ "vaxia_accounts_delete_non_player_user_account" : {
      "LABEL" : "Delete non-player user account",
      "PLUGIN" : "reaction rule",
      "WEIGHT" : "1",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "NOT user_is_blocked" : { "account" : [ "user" ] } },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8" } },
            "operation" : "OR"
          }
        },
        { "data_is" : { "data" : [ "user:created" ], "op" : "\\u003C", "value" : "-3 days" } },
        { "data_is" : { "data" : [ "user:last-login" ], "op" : "\\u003C", "value" : "-14 days" } }
      ],
      "DO" : [
        { "entity_delete" : { "data" : [ "user" ] } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] Non-player user has been deleted",
            "message" : "The following user account has been deleted.\\r\\n\\r\\n[user:name]\\r\\n\\r\\nThe user created the account but did not create a character, and has not logged in since. The account has been deleted as a spambot.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  return $items;
}
