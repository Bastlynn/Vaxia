<?php
/**
 * @file
 * vaxia.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function vaxia_default_rules_configuration() {
  $items = array();
  $items['rules_mark_xp_on_user_on_character_gain'] = entity_import('rules_config', '{ "rules_mark_xp_on_user_on_character_gain" : {
      "LABEL" : "Mark XP on user on character gain",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "vaxia" ],
      "ON" : { "vaxia_gain_xp" : [] },
      "IF" : [ { "text_matches" : { "text" : [ "xp-type" ], "match" : "xp" } } ],
      "DO" : [
        { "data_calc" : {
            "USING" : {
              "input_1" : [ "user:field-xp-over-time" ],
              "op" : "+",
              "input_2" : [ "xp-amount" ]
            },
            "PROVIDE" : { "result" : { "new_user_xp" : "New User XP" } }
          }
        },
        { "data_set" : { "data" : [ "user:field-xp-over-time" ], "value" : [ "new-user-xp" ] } }
      ]
    }
  }');
  $items['rules_notify_char_eval_re_new_character'] = entity_import('rules_config', '{ "rules_notify_char_eval_re_new_character" : {
      "LABEL" : "Notify char eval re: new character",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "3" : "3" } }
          }
        },
        { "data_is" : { "data" : [ "node:field-is-npc" ], "value" : 0 } },
        { "data_is" : { "data" : [ "node:field-is-open-npc" ], "value" : 0 } }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "3" : "3", "9" : "9", "7" : "7", "4" : "4" } },
            "subject" : "[Vaxia] A character is ready to be reviewed",
            "message" : "A character is ready to be reviewed.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to evaluate characters. Please do so before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 week\\u0027)); ?\\u003E. If this character does not meet the requirements to be approved, please revert it to \\u0022draft\\u0022 status and send a Private Message to the player with the details on how to bring it up to an approvable quality.  Copy the same notes into the Workflow Comments when you make the change so that we have a record of it with the character itself.\\r\\n\\r\\nIf you are not comfortable with approving characters at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nCharacter: [node:title]\\r\\nLink: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "drupal_message" : { "message" : "Your character has been submitted, and email sent to the character evaluators." } }
      ]
    }
  }');
  $items['rules_notify_char_eval_re_oversight_npc'] = entity_import('rules_config', '{ "rules_notify_char_eval_re_oversight_npc" : {
      "LABEL" : "Notify char eval re: OVERSIGHT NPC",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "3" : "3" } }
          }
        },
        { "php_eval" : { "code" : "$limit = 70;\\r\\n$return_value = FALSE;\\r\\n$fields = array(\\u0027life\\u0027, \\u0027health\\u0027, \\u0027endurance\\u0027, \\u0027constitution\\u0027, \\u0027strength\\u0027, \\u0027agility\\u0027, \\u0027dexterity\\u0027,\\r\\n\\u0027reflexes\\u0027, \\u0027intelligence\\u0027, \\u0027awareness\\u0027, \\u0027spirituality\\u0027, \\u0027presence\\u0027, \\u0027charisma\\u0027, \\u0027appearance\\u0027,\\r\\n);\\r\\n$lang = $node-\\u003Elanguage;\\r\\nforeach ($fields as $field_name) {\\r\\n  $field_name = \\u0027field_\\u0027 . $field_name;\\r\\n  $stat = isset($node-\\u003E{$field_name}[$lang][0][\\u0027value\\u0027]) ?\\r\\n    $node-\\u003E{$field_name}[$lang][0][\\u0027value\\u0027] : 0;\\r\\n  if ($stat \\u003E= $limit) {\\r\\n    $return_value = TRUE;\\r\\n  }\\r\\n  foreach ($node-\\u003Efield_skill[$lang] as $delta =\\u003E $skill) {\\r\\n    $this_skill = field_collection_item_load($skill[\\u0027value\\u0027]);\\r\\n    $skill_lang = isset($skill-\\u003Elanguage) ? $skill-\\u003Elanguage : $lang;\\r\\n    $stat = isset($this_skill-\\u003Efield_skill_value[$skill_lang][0][\\u0027value\\u0027]) ?\\r\\n      $this_skill-\\u003Efield_skill_value[$skill_lang][0][\\u0027value\\u0027] : 0;\\r\\n    if ($stat \\u003E= $limit) {\\r\\n      $return_value = TRUE;\\r\\n    }\\r\\n  }\\r\\n}\\r\\nreturn $return_value;" } },
        { "OR" : [
            { "data_is" : { "data" : [ "node:field-is-npc" ], "value" : 1 } },
            { "data_is" : { "data" : [ "node:field-is-open-npc" ], "value" : 1 } }
          ]
        }
      ],
      "DO" : [
        { "drupal_message" : {
            "message" : "This character falls under OVERSIGHT as it has a stat or skill over 70 points. Please consider if this character is absolutely necessary to have available for play on the site and be ready to validate the need and use of the character.",
            "type" : "warning",
            "repeat" : 0
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "3" : "3", "9" : "9", "4" : "4" } },
            "subject" : "[Vaxia] A NPC has been submitted that needs OVERSIGHT",
            "message" : "An NPC has been submitted that requires oversight.\\r\\n\\r\\nOne (or more) of its stats or skills exceeds 70 points, so NPC requires additional oversight. This character CANNOT be approved without review by an SH (not the author) with notes marked in the workflow regarding intention and use of the NPC in play. NPCs that fall under oversight must be relevant to current play and intended for use in a session within the next 3 months.  \\r\\n\\r\\nYou are receiving this email because you are one of the people available to evaluate characters. Please do so before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 week\\u0027)); ?\\u003E. If this character does not meet the requirements to be approved, please revert it to \\u0022draft\\u0022 status and send a Private Message to the player with the details on how to bring it up to an approvable quality. Copy the same notes into the Workflow Comments when you make the change so that we have a record of it with the character itself.\\r\\n\\r\\nIf you are not comfortable with approving characters at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nCharacter: [node:title]\\r\\nLink: [node:url]\\r\\n\\r\\nAdditional characters or items that need oversight may be found at: http:\\/\\/vaxia.org\\/oversight\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will\\r\\nnot be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_notify_item_eval_re_new_item'] = entity_import('rules_config', '{ "rules_notify_item_eval_re_new_item" : {
      "LABEL" : "Notify item eval re: new item",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "14" : "14" } }
          }
        }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "14" : "14", "4" : "4", "3" : "3" } },
            "subject" : " [Vaxia] An item is ready to be reviewed",
            "message" : "An item is ready to be reviewed.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to evaluate items.  Please do so before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 week\\u0027)); ?\\u003E. If this item does not meet the requirements to be approved, please revert it to \\u0022draft\\u0022 status and send a Private Message to the player with the details on how to bring it up to an approvable quality.  Copy the same notes into the Workflow Comments when you make the change so that we have a record of it with the item in question.\\r\\n\\r\\nIf you are not comfortable with approving items at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nItem: [node:title]\\r\\nLink: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "drupal_message" : { "message" : "Your item has been submitted, and email sent to the item evaluators." } }
      ]
    }
  }');
  $items['rules_notify_player_when_char_disapproved'] = entity_import('rules_config', '{ "rules_notify_player_when_char_disapproved" : {
      "LABEL" : "Notify player when char disapproved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "3" : "3", "4" : "4" } },
            "new_state" : { "value" : { "2" : "2" } }
          }
        },
        { "data_is" : { "data" : [ "node:field-is-npc" ], "value" : 0 } },
        { "data_is" : { "data" : [ "node:field-is-open-npc" ], "value" : 0 } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your new character needs changes made",
            "message" : "Your character, [node:title], has NOT been approved and is NOT ready to play, because there are some remaining changes that need to be made.\\r\\n\\r\\nYour character was disapproved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nPlease review the notes for your character (found under the \\u0022Workflow\\u0022 tab) and address any concerns noted there before resubmitting the character. You may contact the evaluators ( http:\\/\\/vaxia.org\\/wiki\\/storytellers-and-assistants ) for further assistance in revising your concept.\\r\\n\\r\\nYou can also review the Character Creation guide to go over the basics of creating a Vaxian character: http:\\/\\/vaxia.org\\/wiki\\/character-creation\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "8" : "8" } } } }
      ]
    }
  }');
  $items['rules_notify_player_when_char_eval'] = entity_import('rules_config', '{ "rules_notify_player_when_char_eval" : {
      "LABEL" : "Notify player when char approved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "4" : "4" } }
          }
        },
        { "data_is" : { "data" : [ "node:field-is-npc" ], "value" : 0 } },
        { "data_is" : { "data" : [ "node:field-is-open-npc" ], "value" : 0 } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your character has been approved",
            "message" : "Your character, [node:title], has been approved and is ready to play! \\r\\n\\r\\nYour character was approved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nIf you need help getting started, please take a look at our help pages: http:\\/\\/vaxia.org\\/wiki\\/help \\r\\n\\r\\nIf you have additional questions, asking them in Limbo ( http:\\/\\/vaxia.org\\/locations\\/limbo ) should get you answers from our other players on the site.\\r\\n\\r\\nIf you\\u0027re interested in sessions, the calender of scheduled sessions can be found here: http:\\/\\/vaxia.org\\/calendar\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "8" : "8" } } } }
      ]
    }
  }');
  $items['rules_unpublish_child_rooms_when_room_unpublished'] = entity_import('rules_config', '{ "rules_unpublish_child_rooms_when_room_unpublished" : {
      "LABEL" : "Unpublish child rooms when room unpublished",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_update" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "rpg_chatroom" : "rpg_chatroom" } }
          }
        },
        { "node_is_published" : { "node" : [ "node-unchanged" ] } },
        { "NOT node_is_published" : { "node" : [ "node" ] } }
      ],
      "DO" : [
        { "entity_query" : {
            "USING" : {
              "type" : "node",
              "property" : "field_parent",
              "value" : [ "node" ],
              "limit" : "100"
            },
            "PROVIDE" : { "entity_fetched" : { "entity_fetched" : "Fetched entity" } }
          }
        },
        { "LOOP" : {
            "USING" : { "list" : [ "entity-fetched" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [
              { "node_unpublish" : { "node" : [ "list-item" ] } },
              { "entity_save" : { "data" : [ "list-item" ], "immediate" : 1 } },
              { "drupal_message" : { "message" : "The child location [list-item:title] has also been unpublished." } }
            ]
          }
        }
      ]
    }
  }');
  $items['vaxia_notify_char_eval_re_new_character_other'] = entity_import('rules_config', '{ "vaxia_notify_char_eval_re_new_character_other" : {
      "LABEL" : "Notify char eval re: new character OTHER",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "3" : "3" } }
          }
        },
        { "data_is" : { "data" : [ "node:field-is-npc" ], "value" : 0 } },
        { "data_is" : { "data" : [ "node:field-is-open-npc" ], "value" : 0 } },
        { "OR" : [
            { "data_is" : { "data" : [ "node:field-race" ], "value" : "other" } },
            { "data_is" : { "data" : [ "node:field-conditions" ], "value" : "other" } }
          ]
        }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] A character is ready to be reviewed with \\u0022Other\\u0022 values",
            "message" : "A character is ready to be reviewed.\\r\\n\\r\\nBecause this character has listed \\u0022Other\\u0022 in Race or Conditions, this character is subject to additional World overview. The character, for whatever reason, needs to be reviewed and the player checked to make sure this character is appropriate for the setting. If you want to look at the character, please do so so you will be familiar with the character when it shows up in sessions.\\r\\n\\r\\nBecause this character requires World approval, please allow World for the Realm involved to take a look and issue approval.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to evaluate characters. If you are not comfortable with approving characters at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nCharacter: [node:title]\\r\\nLink: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "drupal_message" : { "message" : "Your character has listed \\u0022Other\\u0022 in Race or Conditions. This character is subject to World approval. Please keep an eye on your email and PMs so our evaluators can follow up with you for this character." } }
      ]
    }
  }');
  $items['vaxia_notify_char_eval_re_oversight_npc_pass_npc'] = entity_import('rules_config', '{ "vaxia_notify_char_eval_re_oversight_npc_pass_npc" : {
      "LABEL" : "Notify char eval re: OVERSIGHT NPC - pass_npc",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "3" : "3" } }
          }
        },
        { "NOT php_eval" : { "code" : "$limit = 70;\\r\\n$return_value = FALSE;\\r\\n$fields = array(\\u0027life\\u0027, \\u0027health\\u0027, \\u0027endurance\\u0027, \\u0027constitution\\u0027, \\u0027strength\\u0027, \\u0027agility\\u0027, \\u0027dexterity\\u0027,\\r\\n\\u0027reflexes\\u0027, \\u0027intelligence\\u0027, \\u0027awareness\\u0027, \\u0027spirituality\\u0027, \\u0027presence\\u0027, \\u0027charisma\\u0027, \\u0027appearance\\u0027,\\r\\n);\\r\\n$lang = $node-\\u003Elanguage;\\r\\nforeach ($fields as $field_name) {\\r\\n  $field_name = \\u0027field_\\u0027 . $field_name;\\r\\n  $stat = isset($node-\\u003E{$field_name}[$lang][0][\\u0027value\\u0027]) ?\\r\\n    $node-\\u003E{$field_name}[$lang][0][\\u0027value\\u0027] : 0;\\r\\n  if ($stat \\u003E= $limit) {\\r\\n    $return_value = TRUE;\\r\\n  }\\r\\n  foreach ($node-\\u003Efield_skill[$lang] as $delta =\\u003E $skill) {\\r\\n    $this_skill = field_collection_item_load($skill[\\u0027value\\u0027]);\\r\\n    $skill_lang = isset($skill-\\u003Elanguage) ? $skill-\\u003Elanguage : $lang;\\r\\n    $stat = isset($this_skill-\\u003Efield_skill_value[$skill_lang][0][\\u0027value\\u0027]) ?\\r\\n      $this_skill-\\u003Efield_skill_value[$skill_lang][0][\\u0027value\\u0027] : 0;\\r\\n    if ($stat \\u003E= $limit) {\\r\\n      $return_value = TRUE;\\r\\n    }\\r\\n  }\\r\\n}\\r\\nreturn $return_value;" } },
        { "OR" : [
            { "data_is" : { "data" : [ "node:field-is-npc" ], "value" : 1 } },
            { "data_is" : { "data" : [ "node:field-is-open-npc" ], "value" : 1 } }
          ]
        }
      ],
      "DO" : [
        { "workflow_rules_set_state" : {
            "node" : [ "node" ],
            "workflow_state" : { "value" : { "4" : "4" } },
            "workflow_comment" : "Passing NPC to approved. All stats and skills under 70. (executed by system:rules:oversight_npc_pass)"
          }
        },
        { "php_eval" : { "code" : "\\u003C?php\\r\\n\\/\\/ Update the timestamp for the latest workflow to avoid a timestamp collision.\\r\\ndb_query(\\u0027UPDATE {workflow_node_history} \\u0027 .\\r\\n  \\u0027SET stamp = stamp+10 \\u0027 .\\r\\n  \\u0027WHERE nid = :nid \\u0027 .\\r\\n  \\u0027ORDER BY hid DESC \\u0027 .\\r\\n  \\u0027LIMIT 1\\u0027,\\r\\n  array(\\u0027:nid\\u0027 =\\u003E $node-\\u003Enid)\\r\\n);\\r\\n?\\u003E" } },
        { "drupal_message" : {
            "message" : "This character has all stat and skills under 70 points. Therefore the character does not require oversight and has been passed along directly to approval.",
            "type" : "warning",
            "repeat" : 0
          }
        }
      ]
    }
  }');
  $items['vaxia_notify_player_when_item_approved'] = entity_import('rules_config', '{ "vaxia_notify_player_when_item_approved" : {
      "LABEL" : "Notify player when item approved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "15" : "15" } }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your item has been approved",
            "message" : "Your item, [node:title], has been approved and is ready to play! \\r\\n\\r\\nYour item was approved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nIf you have additional questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['vaxia_notify_player_when_item_disapproved'] = entity_import('rules_config', '{ "vaxia_notify_player_when_item_disapproved" : {
      "LABEL" : "Notify player when item disapproved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Vaxia" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "3" : "3", "4" : "4" } },
            "new_state" : { "value" : { "2" : "2" } }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your new item needs changes made",
            "message" : "Your item, [node:title], has NOT been approved and is NOT ready to play, because there are some remaining changes that need to be made.\\r\\n\\r\\nYour item was disapproved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nPlease review the notes for your item (found under the \\u0022Workflow\\u0022 tab) and address any concerns noted there before resubmitting. You may contact the evaluators ( http:\\/\\/vaxia.org\\/wiki\\/storytellers-and-assistants ) for further assistance in revising your concept.\\r\\n\\r\\nIf you have any questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  return $items;
}
