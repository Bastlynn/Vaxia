<?php
/**
 * @file
 * vaxia_scene.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function vaxia_scene_default_rules_configuration() {
  $items = array();
  $items['items_notify_player_when_scene_ruled'] = entity_import('rules_config', '{ "items_notify_player_when_scene_ruled" : {
      "LABEL" : "Notify player when scene ruled",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Scene" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "scene" : "scene" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "29" : "29" } }
          }
        },
        { "NOT user_is_blocked" : { "account" : [ "node:author" ] } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your scene has been ruled",
            "message" : "Your scene, [node:title], has been ruled!\\r\\n\\r\\nYour scene was ruled with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nYou can find the scene at: [node:url]\\r\\n\\r\\nIf you have additional questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['items_notify_sh_re_new_scene'] = entity_import('rules_config', '{ "items_notify_sh_re_new_scene" : {
      "LABEL" : "Notify sh re: new scene",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Scene" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "scene" : "scene" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "28" : "28" } }
          }
        }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "3" : "3", "14" : "14" } },
            "subject" : " [Vaxia] A scene is ready to be ruled",
            "message" : " A scene is ready to be ruled.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to rule scenes. Please take a moment to review this scene for any related XP \\/ item \\/ skill or other project as needed. When you rule this scene be sure to make note of it in the workflow comments so other Storyhosts know it has been taken care of and what the result was. Please do so before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 week\\u0027)); ?\\u003E.\\r\\n\\r\\nScene: [node:title]\\r\\nLink: [node:url]\\r\\nThis scene is created by: [node:author]\\r\\n\\r\\nIf you are not comfortable with reviewing scenes at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "drupal_message" : { "message" : "Your scene has been submitted, and email sent to the storyhosts." } }
      ]
    }
  }');
  $items['rules_creating_scene_move_to_workflow'] = entity_import('rules_config', '{ "rules_creating_scene_move_to_workflow" : {
      "LABEL" : "Creating scene move to workflow",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Scene" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_insert--scene" : { "bundle" : "scene" } },
      "DO" : [
        { "redirect" : { "url" : "node\\/[node:nid]\\/workflow" } },
        { "drupal_message" : { "message" : "Don\\u0027t forget to set the scene to submitted so that the storyhost team can review it." } }
      ]
    }
  }');
  return $items;
}
