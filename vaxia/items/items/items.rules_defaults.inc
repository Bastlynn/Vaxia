<?php
/**
 * @file
 * items.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function items_default_rules_configuration() {
  $items = array();
  $items['rules_creating_item_move_to_workflow'] = entity_import('rules_config', '{ "rules_creating_item_move_to_workflow" : {
      "LABEL" : "Creating item move to workflow",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Items" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_insert--items" : { "bundle" : "items" } },
      "DO" : [
        { "redirect" : { "url" : "node\\/[node:nid]\\/workflow" } },
        { "drupal_message" : { "message" : "Don\\u0027t forget to set the item to submitted so that the evaluation team can review it." } }
      ]
    }
  }');
  $items['rules_item_removed_from_game'] = entity_import('rules_config', '{ "rules_item_removed_from_game" : {
      "LABEL" : "Item removed from game",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Items" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_state" : {
            "node" : [ "node" ],
            "workflow_state" : { "value" : { "16" : "16", "22" : "22" } }
          }
        }
      ],
      "DO" : [
        { "data_set" : { "data" : [ "node:field-character-owner" ], "value" : [ "" ] } },
        { "node_unpublish" : { "node" : [ "node" ] } },
        { "entity_save" : { "data" : [ "node" ] } }
      ]
    }
  }');
  $items['rules_notify_item_eval_re_new_item'] = entity_import('rules_config', '{ "rules_notify_item_eval_re_new_item" : {
      "LABEL" : "Notify item eval re: new item",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Items" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "14" : "14" } }
          }
        }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "14" : "14", "4" : "4", "3" : "3" } },
            "subject" : " [Vaxia] An item is ready to be reviewed",
            "message" : "An item is ready to be reviewed.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to evaluate items. Neither [node:author] nor [node:field-character-owner:author] can approve this items. If you are not either of these players, please evaluate this item. Please do so before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 week\\u0027)); ?\\u003E. If this item does not meet the requirements to be approved, please revert it to \\u0022draft\\u0022 status and send a Private Message to the player with the details on how to bring it up to an approvable quality.  Copy the same notes into the Workflow Comments when you make the change so that we have a record of it with the item in question.\\r\\n\\r\\nItem: [node:title]\\r\\nLink: [node:url]\\r\\n\\r\\nThis item is created by: [node:author]\\r\\nAnd created for the character: [node:field-character-owner:title], owned by: [node:field-character-owner:author]\\r\\n\\r\\nIf you are not comfortable with approving items at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "drupal_message" : { "message" : "Your item has been submitted, and email sent to the item evaluators." } }
      ]
    }
  }');
  $items['vaxia_notify_player_when_item_approved'] = entity_import('rules_config', '{ "vaxia_notify_player_when_item_approved" : {
      "LABEL" : "Notify player when item approved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Items" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "13" : "13", "14" : "14" } },
            "new_state" : { "value" : { "15" : "15" } }
          }
        },
        { "NOT user_is_blocked" : { "account" : [ "node:author" ] } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your item has been approved",
            "message" : "Your item, [node:title], has been approved and is ready to play! \\r\\n\\r\\nYour item was approved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nIf you have additional questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['vaxia_notify_player_when_item_disapproved'] = entity_import('rules_config', '{ "vaxia_notify_player_when_item_disapproved" : {
      "LABEL" : "Notify player when item disapproved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Items" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "items" : "items" } } } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "3" : "3", "4" : "4" } },
            "new_state" : { "value" : { "2" : "2" } }
          }
        },
        { "NOT user_is_blocked" : { "account" : [ "node:author" ] } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your new item needs changes made",
            "message" : "Your item, [node:title], has NOT been approved and is NOT ready to play, because there are some remaining changes that need to be made.\\r\\n\\r\\nYour item was disapproved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nPlease review the notes for your item (found under the \\u0022Workflow\\u0022 tab) and address any concerns noted there before resubmitting. You may contact the evaluators ( http:\\/\\/vaxia.org\\/wiki\\/storytellers-and-assistants ) for further assistance in revising your concept.\\r\\n\\r\\nIf you have any questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  return $items;
}
