<?php
/**
 * @file
 * vaxia_accounts.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function vaxia_accounts_default_rules_configuration() {
  $items = array();
  $items['rules_red_strike'] = entity_import('rules_config', '{ "rules_red_strike" : {
      "LABEL" : "Red strike",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "Vaxia Reputation" ],
      "REQUIRES" : [ "rules", "php", "userpoints_rules" ],
      "ON" : [ "node_insert" ],
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "strike" : "strike" } } } },
        { "data_is" : {
            "data" : [ "node:field-severity" ],
            "value" : "Red - severe warning (suspension)"
          }
        }
      ],
      "DO" : [
        { "entity_fetch" : {
            "USING" : { "type" : "user", "id" : [ "node:field-player:uid" ] },
            "PROVIDE" : { "entity_fetched" : { "entity_fetched" : "Striked user" } }
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "3" : "3", "9" : "9", "4" : "4" } },
            "subject" : "[Vaxia] A red strike has been issued",
            "message" : "A red strike has been issued against [entity-fetched:name].\\r\\n\\r\\nPlease review the details at [node:url] , so that you are familar with the circumstances.\\r\\n\\r\\nIf you have more information to provide to the situation please contact [node:author] to add your documentation. Further questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\nAs a red strike, [entity-fetched:name] is banned from the site until \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "mail" : {
            "to" : "[entity-fetched:mail]",
            "subject" : "[Vaxia] A red strike has been issued against you",
            "message" : "A red strike has been issued against you.\\r\\n\\r\\nPlease review the details at [node:url] , so that you are familar with the circumstances.\\r\\n\\r\\nFurther questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\nAs a red strike, you are banned from the site until \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        },
        { "user_block" : { "account" : [ "entity-fetched" ] } },
        { "userpoints_action_grant_points" : {
            "user" : [ "entity-fetched" ],
            "points" : "-10",
            "tid" : "0",
            "entity" : [ "" ],
            "description" : "-10 v-rep for a strike.",
            "operation" : "Remove",
            "display" : 0,
            "moderate" : "approved"
          }
        }
      ]
    }
  }');
  $items['rules_rem_sh_role_if_absentee_6mo'] = entity_import('rules_config', '{ "rules_rem_sh_role_if_absentee_6mo" : {
      "LABEL" : "Rem priv roles if absentee 3mo",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "Positions" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : [ "user_stats_day_older" ],
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "9" : "9", "10" : "10", "7" : "7", "4" : "4", "11" : "11" } },
            "operation" : "OR"
          }
        },
        { "data_is" : {
            "data" : [ "user:last-access" ],
            "op" : "\\u003C",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -7776000 } }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "9" : "9", "10" : "10", "7" : "7", "4" : "4", "11" : "11" } }
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "3" : "3", "9" : "9", "7" : "7", "4" : "4" } },
            "subject" : "[Vaxia] Administrative privileges lost ",
            "message" : "[user:name] has been absent from the site for 3 months, and has lost all permissions above player as a result.\\r\\n\\r\\nYou are receiving this email because you share some of the same roles, and need to be aware of the changes. If this is a position that needs to be critically filled, please consult with other leadership on the site to recruit or nominate new members to this position.\\r\\n\\r\\nWhile we understand the need to prioritize life over game, we do need members in leadership positions to uphold their responsibilities. [user:name]\\u0027s loss of position due to absence does not preclude re-gaining the position upon return to the site - on the condition that the return is intended to be a long-term return.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_retire_blocked_user_characters'] = entity_import('rules_config', '{ "rules_retire_blocked_user_characters" : {
      "LABEL" : "Retire blocked user nodes (char, art, items)",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "TAGS" : [ "Retire" ],
      "REQUIRES" : [ "rules" ],
      "ON" : [ "user_update" ],
      "IF" : [ { "user_is_blocked" : { "account" : [ "account" ] } } ],
      "DO" : [
        { "entity_query" : {
            "USING" : { "type" : "node", "property" : "author", "value" : [ "account" ] },
            "PROVIDE" : { "entity_fetched" : { "entity_fetched" : "Fetched entity" } }
          }
        },
        { "LOOP" : {
            "USING" : { "list" : [ "entity-fetched" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [ { "node_unpublish" : { "node" : [ "list-item" ] } } ]
          }
        }
      ]
    }
  }');
  $items['rules_retire_inactive_user_account'] = entity_import('rules_config', '{ "rules_retire_inactive_user_account" : {
      "LABEL" : "Retire inactive user account",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "Retire" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : [ "user_stats_day_older" ],
      "IF" : [
        { "NOT user_is_blocked" : { "account" : [ "user" ] } },
        { "data_is" : {
            "data" : [ "user:created" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -31104000 }
            }
          }
        },
        { "data_is" : {
            "data" : [ "user:last-access" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -31536000 }
            }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : "bastlynn@gmail.com",
            "subject" : "VAXIA: BLOCK RULE TRIGGERED ",
            "message" : "VAXIA: BLOCK RULE TRIGGERED for 1 yr on: [user:name]  - last access: [user:last-access]",
            "language" : [ "" ]
          }
        },
        { "user_block" : { "account" : [ "user" ] } }
      ]
    }
  }');
  $items['rules_retire_unused_user_account'] = entity_import('rules_config', '{ "rules_retire_unused_user_account" : {
      "LABEL" : "Delete unused user account",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "Retire" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : [ "user_stats_day_older" ],
      "IF" : [
        { "NOT user_is_blocked" : { "account" : [ "user" ] } },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : {
                "3" : "3",
                "8" : "8",
                "9" : "9",
                "10" : "10",
                "7" : "7",
                "4" : "4",
                "11" : "11"
              }
            },
            "operation" : "OR"
          }
        },
        { "data_is" : {
            "data" : [ "user:created" ],
            "op" : "\\u003C",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -259200 } }
          }
        },
        { "data_is_empty" : { "data" : [ "user:last-login" ] } }
      ],
      "DO" : [ { "entity_delete" : { "data" : [ "user" ] } } ]
    }
  }');
  $items['rules_yellow_strike'] = entity_import('rules_config', '{ "rules_yellow_strike" : {
      "LABEL" : "Yellow strike",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "Vaxia Reputation" ],
      "REQUIRES" : [ "rules", "userpoints_rules" ],
      "ON" : [ "node_insert" ],
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "strike" : "strike" } } } },
        { "data_is" : {
            "data" : [ "node:field-severity" ],
            "value" : "Yellow - moderate warning"
          }
        }
      ],
      "DO" : [
        { "entity_fetch" : {
            "USING" : { "type" : "user", "id" : [ "node:field-player:uid" ] },
            "PROVIDE" : { "entity_fetched" : { "entity_fetched" : "Striked user" } }
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "3" : "3", "9" : "9", "4" : "4" } },
            "subject" : "[Vaxia] A yellow strike has been issued",
            "message" : "A yellow strike has been issued against [entity-fetched:name].\\r\\n\\r\\nPlease review the details at [node:url] , so that you are familar with the circumstances.\\r\\n\\r\\nIf you have more information to provide to the situation please contact [node:author] to add your documentation. Further questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "mail" : {
            "to" : "[entity-fetched:mail]",
            "subject" : "[Vaxia] A yellow strike has been issued against you",
            "message" : "A yellow strike has been issued against you.\\r\\n\\r\\nPlease review the details at [node:url] , so that you are familar with the circumstances.\\r\\n\\r\\nFurther questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        },
        { "userpoints_action_grant_points" : {
            "user" : [ "entity-fetched" ],
            "points" : "-10",
            "tid" : "0",
            "entity" : [ "node" ],
            "description" : "-10 v-rep for a strike.",
            "operation" : "Remove",
            "display" : 0,
            "moderate" : "approved"
          }
        }
      ]
    }
  }');
  return $items;
}
