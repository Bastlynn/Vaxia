<?php
/**
 * @file
 * vaxia_sh_test.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function vaxia_sh_test_default_rules_configuration() {
  $items = array();
  $items['rules_response_sh_application'] = entity_import('rules_config', '{ "rules_response_sh_application" : {
      "LABEL" : "Response SH Application",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "storyhost_application" : "storyhost_application" } }
          }
        },
        { "node_is_webform" : { "node" : [ "node" ] } },
        { "user_has_role" : {
            "account" : [ "node:author" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "17" : "17" } }
          }
        },
        { "php_eval" : { "code" : "$results = db_query(\\u0022SELECT wd.data FROM {webform_submitted_data} wd \\u0022 .\\r\\n  \\u0022WHERE wd.nid = :nid \\u0022 .\\r\\n  \\u0022AND wd.cid = 1\\u0022, \\/\\/ There is only the one form element.\\r\\n  array(\\r\\n    \\u0027:nid\\u0027 =\\u003E $node-\\u003Enid,\\r\\n  ));\\r\\n$count = 0;\\r\\nforeach ($results as $result) {\\r\\n  if ($result-\\u003Edata == \\u0027approve\\u0027) {\\r\\n    $count++;\\r\\n  }\\r\\n}\\r\\nif ($count \\u003E 3) {\\r\\n  return TRUE;\\r\\n}\\r\\nreturn FALSE;" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "17" : "17" } } } },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "9" : "9" } } } },
        { "data_set" : { "data" : [ "node:author:field-took-ash1" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-took-ash2" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-took-ash3" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-became-sh" ], "value" : "now" } },
        { "drupal_message" : { "message" : "SH Candidate [node:author:name] has received three approvals and has been promoted to a full Storyhost." } },
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] SH privileges granted",
            "message" : "You have been approved to join the Storyhost\\u0027s on Vaxia. Congratulations!\\r\\n\\r\\nWhen you next see other SH\\u0027s on site, please take a moment to see if any of their stories and your stories can fit together. If you have questions about your sessions, other SHs and World heads are available to answer any questions you may have.\\r\\n\\r\\nWe do ask Storyhosts to regularly run a session once every 3 months, this position is a working volunteer position to serve the needs of the site, so we do need you to fulfill the duties of that role. If you do take an unexpected extended vacation and lose your permissions as a Storyhost you will need to retrain in order to return to Storyhost position. If you know you need to take a vacation, check under your user account for the Vacation button.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] New SH approved",
            "message" : "Storyhost Candidate [user:name] has been promoted to SH!\\r\\n\\r\\nYou are receiving this email because you are one of the Storyhosts.\\r\\n\\r\\nPlease congratulate your new fellow SH when you see them next. Feel free to coordinate with each other if any of their stories and your stories can fit together.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~\\r\\n"
          }
        }
      ]
    }
  }');
  $items['rules_sh_renewal'] = entity_import('rules_config', '{ "rules_sh_renewal" : {
      "LABEL" : "SH Renewal",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Positions" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "15" : "15", "9" : "9" } },
            "operation" : "OR"
          }
        },
        { "OR" : [
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } }
          ]
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash1" ],
            "op" : "\\u003E",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -2592000 } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash2" ],
            "op" : "\\u003E",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -2592000 } }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "15" : "15" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have renewed your SH permissions",
            "message" : "You have renewed their Storyhost permissions by passing ASH Test 1 and ASH Test 2 within the last month.\\r\\n\\r\\nCongratulations!\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] A SH has renewed permissions",
            "message" : "[user:name] has renewed their Storyhost permissions by passing ASH Test 1 and ASH Test 2 within the last month.\\r\\n\\r\\nRenewed Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_1_expire'] = entity_import('rules_config', '{ "rules_sh_test_1_expire" : {
      "LABEL" : "SH Test 1 Expire",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash1" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -15552000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been dropped from the ASH program",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test One, nor completed ASH Test Two.\\r\\n\\r\\nYou are still eligible for ASH, but please try to complete your testing promptly when you next apply. You will need to retake ASH Test One: http:\\/\\/vaxia.org\\/content\\/ash-test-1-story-hosting-basics\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] ASH member dropped from the program",
            "message" : "[user:name] has not completed three sessions and ASH Test Two within the time alloted, and has lost all permissions above player as a result.\\r\\n\\r\\nYou are receiving this email because you are eligible as a Storyhost mentor, and need to be aware of the change.\\r\\n\\r\\nFor whatever reason this player was not ready to fulfill duties as an ASH yet. They are still eligable to become an ASH again when they retake ASH Test One, but a Storyhost mentor should check with this player to determine why they were not able to complete the test earlier.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_1_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_1_mark_pass" : {
      "LABEL" : "SH Test 1 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } } ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test One." } }
      ]
    }
  }');
  $items['rules_sh_test_1_response'] = entity_import('rules_config', '{ "rules_sh_test_1_response" : {
      "LABEL" : "SH Test 1 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "13" : "13", "10" : "10", "9" : "9" } },
            "operation" : "OR"
          }
        }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] A new SH applicant has completed ASH Test One",
            "message" : "A player had passed ASH Test One!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run three sessions with an SH mentor on hand to handle the numbers within the next six  months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions. The new ASH does *not* have powers to view sheets or assign XP. The mentor will need to do that for them.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test One",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test One. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Two, you need to practice some of what you\\u0027ve learned so far. You must run three sessions with an SH mentor on hand to handle the numbers within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions, so please feel free to contact any of them to coordinate your sessions.\\r\\n\\r\\nOnce you are done with your three sessions, take ASH Test Two: http:\\/\\/vaxia.org\\/content\\/ash-test-2-ruling\\r\\n\\r\\nWelcome aboard, we\\u0027re looking forward to working with you.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_expire'] = entity_import('rules_config', '{ "rules_sh_test_2_expire" : {
      "LABEL" : "SH Test 2 Expire",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "10" : "10", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash2" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -15552000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been downgrades in the ASH program",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test Two, nor completed your ASH testing.\\r\\n\\r\\nYou are still eligible for ASH, but please try to complete your testing promptly when you next apply. You will need to retake ASH Test Two to continue: http:\\/\\/vaxia.org\\/content\\/ash-test-2-ruling\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] ASH member downgraded in program",
            "message" : "[user:name] has not completed five sessions and ASH Test Final within the time allotted, and been downgraded to ASH One as a result. This player will need to retake ASH Test Two.\\r\\n\\r\\nYou are receiving this email because you are eligible as a Storyhost mentor, and need to be aware of the change.\\r\\n\\r\\nFor whatever reason this player was not ready to fulfill duties as an ASH yet. They are still eligible to become an ASH again when they retake ASH Test Two, but a Storyhost mentor should check with this player to determine why they were not able to complete the test earlier.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_2_mark_pass" : {
      "LABEL" : "SH Test 2 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } } ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash2" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test Two." } }
      ]
    }
  }');
  $items['rules_sh_test_2_response'] = entity_import('rules_config', '{ "rules_sh_test_2_response" : {
      "LABEL" : "SH Test 2 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "9" : "9", "10" : "10" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "$count = 0;\\r\\n$nodes = node_load_multiple(array(), array(\\u0027type\\u0027 =\\u003E \\u0027session_report\\u0027, \\u0027uid\\u0027 =\\u003E $user-\\u003Euid ));\\r\\nforeach ($nodes as $node) {\\r\\n  if ($node-\\u003Estatus == 1) {\\r\\n    $count++;\\r\\n  }\\r\\n}\\r\\nif ($count \\u003E 2) {\\r\\n  return TRUE;\\r\\n}\\r\\nreturn FALSE;" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] An ASH has passed ASH Test Two",
            "message" : "A player had passed ASH Test Two!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run five sessions within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The new ASH has received ASH powers and may now view sheets.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test Two",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test Two. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Three, you need to practice some of what you\\u0027ve learned so far. You must run five sessions within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E.\\r\\n\\r\\nWith passing ASH Test Two you are now empowered with the ability to view sheets, assign XP and generally act as a direct SH. Do not abuse this power.\\r\\n\\r\\nOnce you are done with your five sessions, take ASH Test Three: http:\\/\\/vaxia.org\\/content\\/ash-test-3-advanced-story-hosting\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_3_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_3_mark_pass" : {
      "LABEL" : "SH Test 3 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "7181" } } ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash3" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Your answers to ASH Test Three have been marked on your application. Please give our SHs time to review them." } }
      ]
    }
  }');
  $items['rules_sh_test_3_response'] = entity_import('rules_config', '{ "rules_sh_test_3_response" : {
      "LABEL" : "SH Test 3 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7181" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "10" : "10" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "17" : "17", "9" : "9" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "$count = 0;\\r\\n$nodes = node_load_multiple(array(), array(\\u0027type\\u0027 =\\u003E \\u0027session_report\\u0027, \\u0027uid\\u0027 =\\u003E $user-\\u003Euid ));\\r\\nforeach ($nodes as $node) {\\r\\n  if ($node-\\u003Estatus == 1) {\\r\\n    $count++;\\r\\n  }\\r\\n}\\r\\nif ($count \\u003E 7) {\\r\\n  return TRUE;\\r\\n}\\r\\nreturn FALSE;" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "17" : "17" } } } },
        { "entity_create" : {
            "USING" : {
              "type" : "node",
              "param_type" : "storyhost_application",
              "param_title" : "Application: [user:name]",
              "param_author" : [ "user" ]
            },
            "PROVIDE" : { "entity_created" : { "entity_created" : "Created application" } }
          }
        },
        { "entity_save" : { "data" : [ "entity-created" ], "immediate" : 1 } },
        { "php_eval" : { "code" : "\\/\\/ Find the result ID for this test taken.\\r\\n$uid = $user-\\u003Euid;\\r\\n$nid = $node-\\u003Enid;\\r\\n$vid = $node-\\u003Evid;\\r\\n$results = db_query(\\u0022SELECT r.result_id FROM {quiz_node_results} r \\u0022 .\\r\\n  \\u0022WHERE r.uid = :uid \\u0022 .\\r\\n  \\u0022AND r.nid = :nid \\u0022 .\\r\\n  \\u0022AND r.vid = :vid \\u0022 .\\r\\n  \\u0022ORDER BY r.time_end DESC LIMIT 0,1 \\u0022,\\r\\n  array(\\r\\n    \\u0027:uid\\u0027 =\\u003E $uid,\\r\\n    \\u0027:nid\\u0027 =\\u003E $nid,\\r\\n    \\u0027:vid\\u0027 =\\u003E $vid,\\r\\n  ));\\r\\n$rid = \\u0027\\u0027;\\r\\nforeach ($results as $result) {\\r\\n  $rid = $result-\\u003Eresult_id;\\r\\n}\\r\\nif (empty($rid)) {\\r\\n  drupal_set_message(t(\\u0027An error was encountered, no result ID able to be found.\\u0027));\\r\\n  return;\\r\\n}\\r\\n\\r\\n\\/\\/ Now get the printed out set of answers.\\r\\n$questions = _quiz_get_answers($node, $rid);\\r\\nksort($questions);\\r\\n$output = \\u0027\\u0027;\\r\\nforeach ($questions as $question_nid =\\u003E $question) {\\r\\n  $q_title = $question-\\u003Etitle;\\r\\n  $full_question = node_load($question_nid);\\r\\n  $q = $full_question-\\u003Ebody[$full_question-\\u003Elanguage][0][\\u0027value\\u0027];\\r\\n  $a = $question-\\u003Eanswers[0][\\u0027answer\\u0027];\\r\\n  $output .= \\u0027\\u003Ch3\\u003E\\u003Cb\\u003E\\u0027 . $q_title . \\u0027\\u003C\\/b\\u003E\\u003C\\/h3\\u003E\\u003Cp\\u003E\\u003Cb\\u003E\\u0027. $q . \\u0027\\u003C\\/b\\u003E\\u003C\\/p\\u003E\\u003Cp\\u003E\\u0027 . $a . \\u0027\\u003C\\/p\\u003E\\u003Cbr\\/\\u003E\\u0027;\\r\\n}\\r\\nif (empty($output)) {\\r\\n  drupal_set_message(t(\\u0027An error was encountered, no output able to be created.\\u0027));\\r\\n  return;\\r\\n}\\r\\n\\r\\n\\/\\/ Set the webform body\\r\\n$entity_created-\\u003Ebody[$entity_created-\\u003Elanguage][0][\\u0027value\\u0027] = $output;\\r\\n$entity_created-\\u003Ewebform = webform_node_defaults();\\r\\n$entity_created-\\u003Ewebform[\\u0027confirmation\\u0027] = t(\\u0027Thank you!\\u0027);\\r\\n$entity_created-\\u003Ewebform[\\u0027confirmation_format\\u0027] = \\u0027plain_text\\u0027;\\r\\n$entity_created-\\u003Ewebform[\\u0027submit_limit\\u0027] = 1;\\r\\n\\/\\/ Save roles, 9 = Storyteller\\r\\n$record = db_query(\\u0027DELETE FROM {webform_roles} WHERE nid = :nid\\u0027, array(\\u0027:nid\\u0027 =\\u003E $entity_created-\\u003Enid));\\r\\ndrupal_write_record(\\u0027webform_roles\\u0027, array(\\u0027nid\\u0027 =\\u003E $entity_created-\\u003Enid, \\u0027rid\\u0027 =\\u003E 9));\\r\\n\\/\\/ Save it.\\r\\nnode_save($entity_created);\\r\\n\\r\\n\\/\\/ Create the standard webform field for approval.\\r\\n$component = array();\\r\\n$component[\\u0027nid\\u0027] = $entity_created-\\u003Enid;\\r\\n$component[\\u0027pid\\u0027] = 0;\\r\\n$component[\\u0027form_key\\u0027] = \\u0027approval\\u0027;\\r\\n$component[\\u0027name\\u0027] = t(\\u0027Approve\\u0027);\\r\\n$component[\\u0027type\\u0027] = \\u0027select\\u0027;\\r\\n$component[\\u0027mandatory\\u0027] = 1;\\r\\n$component[\\u0027extra\\u0027] = array(\\r\\n    \\u0027description\\u0027 =\\u003E \\u0027\\u0027,\\r\\n    \\u0027items\\u0027 =\\u003E \\u0027approve|\\u0027 .  t(\\u0027Yes. I approve this SH candidate to become a full SH.\\u0027),\\r\\n    \\u0027multiple\\u0027 =\\u003E \\u00271\\u0027,\\r\\n    \\u0027aslist\\u0027 =\\u003E \\u00270\\u0027,\\r\\n  );\\r\\n$component[\\u0027weight\\u0027] = 0;\\r\\n\\/\\/ Include the webform module that allows components to be created.\\r\\nmodule_load_include(\\u0027inc\\u0027, \\u0027webform\\u0027, \\u0027includes\\/webform.components\\u0027);\\r\\nwebform_component_insert($component);" } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] An ASH has passed ASH Test Three",
            "message" : "A player had passed ASH Test Three!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nThis ASH is ready for the final test. A Storyhost application has been created with the answers they provided for ASH Test Three. Please take a look and evaluate if you believe this player is ready to become a full Storyhost. If they aren\\u0027t, please be ready to provide guidance and instruction to the ASH to resolve any lingering concerns. You will need to be specific about your concerns so the ASH can address them and improve on them.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nStoryhost Candidate: [user:name]\\r\\nApplication: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test Three",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test Three. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nA Storyhost application has been created with the answers you provided for ASH Test Three. The current SHs will be reviewing your answers shortly. Three of the current SHs need to approve your application at which point your account will be marked as a full SH. Please give the SHs time to review. If any of them have any questions or concerns they will contact you and ask for further clarification.\\r\\n\\r\\nYour application can be seen here: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_4_response'] = entity_import('rules_config', '{ "rules_sh_test_4_response" : {
      "LABEL" : "SH Test 4 Mark Pass and Response",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "-1" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "12" : "12", "9" : "9" } }
          }
        },
        { "NOT user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the Evaluator Test." } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14" } },
            "subject" : "[Vaxia] A SH has passed the Evaluator Test",
            "message" : " A SH has passed the Evaluator Test!\\r\\n\\r\\nYou are receiving this email because you are on the Storyhost or Evaluator team.\\r\\n\\r\\nThis message is to let you know a new evaluator is on duty. Evaluators review characters, items and other objects in the system with an eye towards overall game and player balance. We can always use more evaluators, so if you aren\\u0027t one yet - please consider taking the training and test to become one. The more eyes we have on the system the more balanced and secure it is.\\r\\n\\r\\nIf you are not comfortable with being a storyhost or evaluator, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Evaluator: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed the Evaluator Test",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed the Evaluator Test.\\r\\n\\r\\nEvaluators review characters, items and other objects in the system with an eye towards overall game and player balance. The more eyes we have on the system the more balanced and secure it is. Do not abuse this power.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  return $items;
}
