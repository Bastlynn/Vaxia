<?php
/**
 * @file
 * vaxia_sh_test.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function vaxia_sh_test_default_rules_configuration() {
  $items = array();
  $items['rules_sh_test_1_expire'] = entity_import('rules_config', '{ "rules_sh_test_1_expire" : {
      "LABEL" : "SH Test 1 Expire",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : [ "user_stats_day_older" ],
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash1" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -15552000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been dropped from the ASH program",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test One, nor completed ASH Test Two.\\r\\n\\r\\nYou are still eligible for ASH, but please try to complete your testing promptly when you next apply. You will need to retake ASH Test One.\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] ASH member dropped from the program",
            "message" : "[user:name] has not completed three sessions and ASH Test Two within the time alloted, and has lost all permissions above player as a result.\\r\\n\\r\\nYou are receiving this email because you are eligible as a Storyhost mentor, and need to be aware of the change.\\r\\n\\r\\nFor whatever reason this player was not ready to fulfill duties as an ASH yet. They are still eligable to become an ASH again when they retake ASH Test One, but a Storyhost mentor should check with this player to determine why they were not able to complete the test earlier.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_1_response'] = entity_import('rules_config', '{ "rules_sh_test_1_response" : {
      "LABEL" : "SH Test 1 Response",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : [ "quiz_rules_quiz_passed" ],
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "13" : "13", "10" : "10", "9" : "9" } },
            "operation" : "OR"
          }
        }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test One. You have six months to run three tests and pass ASH Test Two." } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] A new SH applicant has completed ASH Test One",
            "message" : "A player had passed ASH Test One!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run three sessions with an SH mentor on hand to handle the numbers within the next six  months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions. The new ASH does *not* have powers to view sheets or assign XP. The mentor will need to do that for them.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test One",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test One. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Two, you need to practice some of what you\\u0027ve learned so far. You must run three sessions with an SH mentor on hand to handle the numbers within the next six  months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions, so please feel free to contact any of them to coordinate your sessions.\\r\\n\\r\\nWelcome aboard, we\\u0027re looking forward to working with you.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_expire'] = entity_import('rules_config', '{ "rules_sh_test_2_expire" : {
      "LABEL" : "SH Test 2 Expire",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : [ "user_stats_day_older" ],
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "10" : "10", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash2" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -15552000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been downgrades in the ASH program",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test Two, nor completed your ASH testing.\\r\\n\\r\\nYou are still eligible for ASH, but please try to complete your testing promptly when you next apply. You will need to retake ASH Test Two.\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] ASH member downgraded in program",
            "message" : "[user:name] has not completed three sessions and ASH Test Final within the time alloted, and been downgraded to ASH One as a result. This player will need to retake ASH Test Two.\\r\\n\\r\\nYou are receiving this email because you are eligible as a Storyhost mentor, and need to be aware of the change.\\r\\n\\r\\nFor whatever reason this player was not ready to fulfill duties as an ASH yet. They are still eligable to become an ASH again when they retake ASH Test Two, but a Storyhost mentor should check with this player to determine why they were not able to complete the test earlier.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_response'] = entity_import('rules_config', '{ "rules_sh_test_2_response" : {
      "LABEL" : "SH Test 2 Response",
      "PLUGIN" : "reaction rule",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : [ "quiz_rules_quiz_passed" ],
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "9" : "9", "10" : "10" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "$count = 0;\\r\\n$nodes = node_load_multiple(array(), array(\\u0027type\\u0027 =\\u003E \\u0027session_report\\u0027, \\u0027uid\\u0027 =\\u003E $user-\\u003Euid ));\\r\\nforeach ($nodes as $node) {\\r\\n  if ($node-\\u003Estatus == 1) {\\r\\n    $count++;\\r\\n  }\\r\\n}\\r\\nif ($count \\u003E 2) {\\r\\n  return TRUE;\\r\\n}\\r\\nreturn FALSE;" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "data_set" : { "data" : [ "user:field-took-ash2" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test Two. You have six months to run three tests and pass ASH Final." } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] An ASH has passed ASH Test Two",
            "message" : "A player had passed ASH Test Two!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run three sessions with an SH mentor on hand to make sure they understand the rules within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions. The new ASH has received ASH powers and may now view sheets.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test Two",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test Two. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Three, you need to practice some of what you\\u0027ve learned so far. You must run three sessions with an SH mentor on hand to check your numbers within the next six  months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions, so please feel free to contact any of them to coordinate your sessions.\\r\\n\\r\\nWith passing ASH Test Two you are now empowered with the ability to view sheets, assign XP and generally act as a direct SH. Do not abuse this power.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_3_response_cloned_'] = entity_import('rules_config', '{ "rules_sh_test_3_response_cloned_" : {
      "LABEL" : "SH Test 3 Response",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "webform_rules", "quiz_rules" ],
      "ON" : [ "quiz_rules_quiz_passed" ],
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "1" } } ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] SH Test 2 has been completed",
            "message" : "A user ( USER ) has passed the SH 2 test. They may now run sessions until they pass test 3."
          }
        },
        { "entity_create" : {
            "USING" : {
              "type" : "node",
              "param_type" : "webform",
              "param_title" : "SH Application",
              "param_author" : [ "user" ]
            },
            "PROVIDE" : { "entity_created" : { "entity_created" : "Created entity" } }
          }
        },
        { "webform_open" : { "entity" : [ "entity-created" ], "selected_webform" : { "value" : [] } } },
        { "entity_save" : { "data" : [ "entity-created" ] } }
      ]
    }
  }');
  $items['rules_sh_test_4_response'] = entity_import('rules_config', '{ "rules_sh_test_4_response" : {
      "LABEL" : "SH Test 4 Response",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "php", "rules", "webform_rules" ],
      "ON" : [ "webform_rules_update" ],
      "IF" : [ { "php_eval" : { "code" : "return 1;" } } ],
      "DO" : []
    }
  }');
  return $items;
}
