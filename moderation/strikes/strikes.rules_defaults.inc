<?php
/**
 * @file
 * strikes.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function strikes_default_rules_configuration() {
  $items = array();
  $items['rules_notation_email'] = entity_import('rules_config', '{ "rules_notation_email" : {
      "LABEL" : "Notation Email",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Strikes" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_insert--notation" : { "bundle" : "notation" } },
      "DO" : [
        { "LOOP" : {
            "USING" : { "list" : [ "node:field-players" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [
              { "mail" : {
                  "to" : [ "list-item:mail" ],
                  "subject" : "[Vaxia] A Notation has been entered",
                  "message" : "A Notation has been added by a member of the Social department.\\r\\n\\r\\nYour account has been noted as a player who was directly involved in the incident, a player who is affected by it, or as a social member involved in the resolution of the incident.\\r\\n\\r\\nPlease keep in mind that Notations are simply how we track the course of events and behaviors over time. Notations are used to make sure that we don\\u0027t have multiple members of the Social department respond to something and so we don\\u0027t miss any patterns that form over time.\\r\\n\\r\\nThe Notation is as follows:\\r\\n\\r\\nPlayers Involved:\\r\\n[node:field-players]\\r\\n\\r\\nPlayers Affected:\\r\\n\\r\\nSocial Members:\\r\\n[node:field-social-members]\\r\\n\\r\\nCategories:\\r\\n[node:field-category]\\r\\n\\r\\nResults:\\r\\n[node:field-results]\\r\\n\\r\\nDetails:\\r\\n[node:body]\\r\\n\\r\\nAdditional Documentation:\\r\\n[node:field-documentation]\\r\\n\\r\\nURL:\\r\\n[node:url]\\r\\n\\r\\nNotations are ONLY used to provide a neutral record of warnings, training, and positive feedback.\\r\\n\\r\\nSince Notation are recorded on site and have revision control - they may be used in a grievance to provide evidence logs if needed.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
                  "language" : [ "" ]
                }
              }
            ]
          }
        },
        { "LOOP" : {
            "USING" : { "list" : [ "node:field-social-members" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [
              { "mail" : {
                  "to" : [ "list-item:mail" ],
                  "subject" : "[Vaxia] A Notation has entered",
                  "message" : "A Notation has been added by a member of the Social department.\\r\\n\\r\\nYour account has been noted as a player who was directly involved in the incident, a player who is affected by it, or as a social member involved in the resolution of the incident.\\r\\n\\r\\n\\r\\nPlease keep in mind that Notations are simply how we track the course of events and behaviors over time. Notations are used to make sure that we don\\u0027t have multiple members of the Social department respond to something and so we don\\u0027t miss any patterns that form over time.\\r\\n\\r\\nThe Notation is as follows:\\r\\n\\r\\nPlayers Involved:\\r\\n[node:field-players]\\r\\n\\r\\nPlayers Affected:\\r\\n\\r\\nSocial Members:\\r\\n[node:field-social-members]\\r\\n\\r\\nCategories:\\r\\n[node:field-category]\\r\\n\\r\\nResults:\\r\\n[node:field-results]\\r\\n\\r\\nDetails:\\r\\n[node:body]\\r\\n\\r\\nAdditional Documentation:\\r\\n[node:field-documentation]\\r\\n\\r\\nURL:\\r\\n[node:url]\\r\\n\\r\\nNotations are ONLY used to provide a neutral record of warnings, training, and positive feedback.\\r\\n\\r\\nSince Notation are recorded on site and have revision control - they may be used in a grievance to provide evidence logs if needed.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
                  "language" : [ "" ]
                }
              }
            ]
          }
        },
        { "LOOP" : {
            "USING" : { "list" : [ "node:field-witnesses" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [
              { "mail" : {
                  "to" : [ "list-item:mail" ],
                  "subject" : "[Vaxia] A Notation has entered",
                  "message" : "A Notation has been added by a member of the Social department.\\r\\n\\r\\nYour account has been noted as a player who was directly involved in the incident, a player who is affected by it, or as a social member involved in the resolution of the incident.\\r\\n\\r\\nPlease keep in mind that Notations are simply how we track the course of events and behaviors over time. Notations are used to make sure that we don\\u0027t have multiple members of the Social department respond to something and so we don\\u0027t miss any patterns that form over time.\\r\\n\\r\\nThe Notation is as follows:\\r\\n\\r\\nPlayers Involved:\\r\\n[node:field-players]\\r\\n\\r\\nPlayers Affected:\\r\\n\\r\\nSocial Members:\\r\\n[node:field-social-members]\\r\\n\\r\\nCategories:\\r\\n[node:field-category]\\r\\n\\r\\nResults:\\r\\n[node:field-results]\\r\\n\\r\\nDetails:\\r\\n[node:body]\\r\\n\\r\\nAdditional Documentation:\\r\\n[node:field-documentation]\\r\\n\\r\\nURL:\\r\\n[node:url]\\r\\n\\r\\nNotations are ONLY used to provide a neutral record of warnings, training, and positive feedback.\\r\\n\\r\\nSince Notation are recorded on site and have revision control - they may be used in a grievance to provide evidence logs if needed.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
                  "language" : [ "" ]
                }
              }
            ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "21" : "21" } },
            "subject" : "[Vaxia] A Notation has added",
            "message" : "A Notation has been added by a member of the Social department about an incident on site. As a lead you should be aware of Notations as they are entered.\\r\\n\\r\\nPlease keep in mind that Notations are simply how we track the course of events and behaviors over time. A Notation is not a Strike and does not provide any disciplinary action.\\r\\n\\r\\nThe Notation is as follows:\\r\\n\\r\\nPlayers Involved:\\r\\n[node:field-players]\\r\\n\\r\\nPlayers Affected:\\r\\n\\r\\nSocial Members:\\r\\n[node:field-social-members]\\r\\n\\r\\nCategories:\\r\\n[node:field-category]\\r\\n\\r\\nResults:\\r\\n[node:field-results]\\r\\n\\r\\nDetails:\\r\\n[node:body]\\r\\n\\r\\nAdditional Documentation:\\r\\n[node:field-documentation]\\r\\n\\r\\nURL:\\r\\n[node:url]\\r\\n\\r\\nNotations provide a neutral record of warnings, training, and positive feedback. Since Notation are recorded on site and have revision control - they may be used in a grievance to provide evidence logs if needed.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_red_strike'] = entity_import('rules_config', '{ "rules_red_strike" : {
      "LABEL" : "Red strike and Suspend User",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Strikes", "Suspensions" ],
      "REQUIRES" : [ "rules", "views_rules", "php" ],
      "ON" : { "node_insert" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "strike" : "strike" } } } },
        { "data_is" : { "data" : [ "node:field-severity" ], "value" : "Red" } }
      ],
      "DO" : [
        { "entity_save" : { "data" : [ "node" ], "immediate" : 1 } },
        { "variable_add" : {
            "USING" : { "type" : "list", "value" : [ "" ] },
            "PROVIDE" : { "variable_added" : { "list_for_months" : "List for Months" } }
          }
        },
        { "list_add" : { "list" : [ "list-for-months" ], "item" : [ "node:nid" ] } },
        { "VIEW LOOP" : {
            "VIEW" : "strikes",
            "DISPLAY" : "players_multi_reds",
            "USING" : { "field_struck_player_uid" : [ "node:field-struck-player:uid" ] },
            "ROW VARIABLES" : {
              "title" : { "title" : "Details" },
              "strike_nid" : { "strike_nid" : "Nid" }
            },
            "DO" : [
              { "list_remove" : { "list" : [ "list-for-months" ], "item" : [ "node:nid" ] } },
              { "list_add" : { "list" : [ "list-for-months" ], "item" : [ "strike-nid" ] } },
              { "list_add" : { "list" : [ "list-for-months" ], "item" : [ "strike-nid" ] } },
              { "list_add" : { "list" : [ "list-for-months" ], "item" : [ "strike-nid" ] } }
            ]
          }
        },
        { "variable_add" : {
            "USING" : { "type" : "integer", "value" : "0" },
            "PROVIDE" : { "variable_added" : { "ban_months" : "Ban Months" } }
          }
        },
        { "variable_add" : {
            "USING" : {
              "type" : "date",
              "value" : {
                "select" : "node:field-struck-player:field-banned-until",
                "php" : { "code" : "\\u003C?php\\r\\n$now = strtotime(\\u0027now\\u0027);\\r\\nif ($now \\u003C $value) {\\r\\n  $now = $value;\\r\\n}\\r\\nreturn $now;\\r\\n?\\u003E" }
              }
            },
            "PROVIDE" : { "variable_added" : { "banned_until" : "Banned until" } }
          }
        },
        { "LOOP" : {
            "USING" : { "list" : [ "list-for-months" ] },
            "ITEM" : { "list_item" : "Current list item" },
            "DO" : [
              { "data_set" : {
                  "data" : [ "ban-months" ],
                  "value" : { "select" : "ban-months", "num_offset" : { "value" : "1" } }
                }
              },
              { "data_set" : {
                  "data" : [ "banned-until" ],
                  "value" : { "select" : "banned-until", "date_offset" : { "value" : 2592000 } }
                }
              }
            ]
          }
        },
        { "data_set" : {
            "data" : [ "node:field-struck-player:field-banned-until" ],
            "value" : [ "banned-until" ]
          }
        },
        { "entity_save" : { "data" : [ "node:field-struck-player" ], "immediate" : 1 } },
        { "user_remove_role" : {
            "account" : [ "node:field-struck-player" ],
            "roles" : { "value" : {
                "30" : "30",
                "8" : "8",
                "9" : "9",
                "14" : "14",
                "21" : "21",
                "24" : "24",
                "26" : "26",
                "27" : "27",
                "19" : "19",
                "28" : "28",
                "29" : "29",
                "12" : "12",
                "25" : "25",
                "13" : "13",
                "10" : "10",
                "17" : "17",
                "15" : "15",
                "20" : "20"
              }
            }
          }
        },
        { "user_add_role" : {
            "account" : [ "node:field-struck-player" ],
            "roles" : { "value" : { "32" : "32" } }
          }
        },
        { "user_block" : { "account" : [ "node:field-struck-player" ] } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "21" : "21", "29" : "29" } },
            "subject" : "[Vaxia] A red strike against [node:field-struck-player:name]",
            "message" : "A red strike has been issued against [node:field-struck-player:name].\\r\\n\\r\\nFurther questions or concerns regarding this strike should be directed to [node:author] .\\r\\n\\r\\nFurther questions, concerns, or challenges to this strike, please direct them here: http:\\/\\/vaxia.org\\/contact\\r\\n\\r\\nAs a red strike, [node:field-struck-player:name] is banned from the site for [ban-months:value] month(s).\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "mail" : {
            "to" : [ "node:field-struck-player:mail" ],
            "subject" : "[Vaxia] A red strike has been issued on your account",
            "message" : "A red strike has been issued to your account.\\r\\n\\r\\nFurther questions, concerns, or challenges to this strike, please direct them here: http:\\/\\/vaxia.org\\/contact\\r\\n\\r\\nAs a red strike, you are banned from the site for [ban-months:value] month(s) in addition to any existing bans..\\r\\n\\r\\nIf this is not your first strike within the last year, you may be banned for longer.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_yellow_strike'] = entity_import('rules_config', '{ "rules_yellow_strike" : {
      "LABEL" : "Yellow strike",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Strikes" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_insert" : [] },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "strike" : "strike" } } } },
        { "data_is" : { "data" : [ "node:field-severity" ], "value" : "Yellow" } }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "21" : "21", "29" : "29" } },
            "subject" : "[Vaxia] A yellow strike against [node:field-struck-player:name]",
            "message" : "A yellow strike has been issued against [node:field-struck-player:name].\\r\\n\\r\\nIf you have more information to provide to the situation please contact [node:author] to add your documentation. Further questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "from" : [ "" ]
          }
        },
        { "mail" : {
            "to" : [ "node:field-struck-player:mail" ],
            "subject" : "[Vaxia] A yellow strike has been issued to your account",
            "message" : "A yellow strike has been issued to your account.\\r\\n\\r\\nFurther questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\nIf this is at least your third yellow strike within the last year, you will also have received a red strike and a temporary ban.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "from" : [ "" ],
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['strikes_strikes_third_yellow_strike'] = entity_import('rules_config', '{ "strikes_strikes_third_yellow_strike" : {
      "LABEL" : "Third yellow strike ",
      "PLUGIN" : "reaction rule",
      "WEIGHT" : "5",
      "OWNER" : "rules",
      "TAGS" : [ "Strikes" ],
      "REQUIRES" : [ "rules", "views_rules" ],
      "ON" : { "node_insert--strike" : { "bundle" : "strike" } },
      "IF" : [
        { "node_is_of_type" : { "node" : [ "node" ], "type" : { "value" : { "strike" : "strike" } } } },
        { "data_is" : { "data" : [ "node:field-severity" ], "value" : "Yellow" } },
        { "entity_is_of_bundle" : {
            "entity" : [ "node:field-associated-record" ],
            "type" : "node",
            "bundle" : { "value" : { "notation" : "notation" } }
          }
        }
      ],
      "DO" : [
        { "entity_save" : { "data" : [ "node" ], "immediate" : 1 } },
        { "VIEW LOOP" : {
            "VIEW" : "strikes",
            "DISPLAY" : "players_over_strike",
            "USING" : { "field_struck_player_uid" : [ "node:field-struck-player:uid" ] },
            "ROW VARIABLES" : { "title" : { "title" : "Details" } },
            "DO" : [
              { "mail_to_users_of_role" : {
                  "roles" : { "value" : { "21" : "21", "29" : "29" } },
                  "subject" : "[Vaxia] A Yellow strike has upgraded to a Red strike for [node:field-struck-player:name]",
                  "message" : "A yellow strike has been issued against [node:field-struck-player:name].\\r\\n\\r\\nThey have received more than three yellow strikes within the last year, therefore a red strike has also been issued.\\r\\n\\r\\nIf you have more information to provide to the situation please contact [node:author] to add your documentation. Further questions, concerns, or challenges to this strike should also be directed to [node:author] and to the SH body as a whole.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
                }
              },
              { "entity_create" : {
                  "USING" : {
                    "type" : "node",
                    "param_type" : "strike",
                    "param_title" : "Red strike - [node:field-struck-player:name]",
                    "param_author" : [ "node:author" ]
                  },
                  "PROVIDE" : { "entity_created" : { "red_strike" : "Red strike" } }
                }
              },
              { "data_set" : { "data" : [ "node:field-associated-record" ], "value" : [ "node" ] } },
              { "data_set" : { "data" : [ "red-strike:field-date-of-incident" ], "value" : "now" } },
              { "data_set" : {
                  "data" : [ "red-strike:field-struck-player" ],
                  "value" : [ "node:field-struck-player" ]
                }
              },
              { "data_set" : { "data" : [ "red-strike:field-severity" ], "value" : "Red" } },
              { "list_add" : {
                  "list" : [ "node:field-associated-record:field-red-strike" ],
                  "item" : [ "node:field-struck-player" ],
                  "unique" : 1
                }
              },
              { "list_add" : {
                  "list" : [ "node:field-associated-record:field-results" ],
                  "item" : "red",
                  "unique" : 1
                }
              },
              { "entity_save" : { "data" : [ "red-strike" ] } },
              { "entity_save" : { "data" : [ "node:field-associated-record" ] } }
            ]
          }
        }
      ]
    }
  }');
  return $items;
}
