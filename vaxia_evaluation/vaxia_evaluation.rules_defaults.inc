<?php
/**
 * @file
 * vaxia_evaluation.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function vaxia_evaluation_default_rules_configuration() {
  $items = array();
  $items['items_notify_char_eval_re_new_char'] = entity_import('rules_config', '{ "items_notify_char_eval_re_new_char" : {
      "LABEL" : "Notify char eval re: new char",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Characters" ],
      "REQUIRES" : [ "rules", "workflow_rules", "php" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "ANY" : "ANY" } },
            "new_state" : { "value" : { "3" : "3" } }
          }
        },
        { "NOT user_is_blocked" : { "account" : [ "node:author" ] } }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "14" : "14", "3" : "3" } },
            "subject" : " [Vaxia] A character is ready to be reviewed",
            "message" : "A character is ready to be reviewed.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to evaluate characters.\\r\\n\\r\\nPlease evaluate characters before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 week\\u0027)); ?\\u003E for prompt replies to our players.\\r\\n\\r\\nIf this character does not meet the requirements to be approved, please revert it to \\u0022draft\\u0022 status and send a Private Message to the player with the details on how to bring it up to an approvable quality.  Copy the same notes into the Workflow Comments when you make the change so that we have a record of it with the item in question.\\r\\n\\r\\nCharacter: [node:title]\\r\\nLink: [node:url]\\r\\nPlayer: [node:author]\\r\\n\\r\\nIf you are not comfortable with approving characters at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        },
        { "drupal_message" : { "message" : "Your character has been submitted, and email sent to the character evaluators." } }
      ]
    }
  }');
  $items['items_notify_player_when_char_approved'] = entity_import('rules_config', '{ "items_notify_player_when_char_approved" : {
      "LABEL" : "Notify player when char approved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Characters" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "3" : "3" } },
            "new_state" : { "value" : { "4" : "4" } }
          }
        },
        { "NOT user_is_blocked" : { "account" : [ "node:author" ] } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your character has been approved",
            "message" : "Your character, [node:title], has been approved and is ready to play! \\r\\n\\r\\nYour character was approved with the following notes:\\r\\n\\r\\n[node:workflow-current-state-log-entry]\\r\\n\\r\\nIf you have additional questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\nAs you get started with your new character, there are a few things - especially if this is your first one, that you\\u0027ll want to get familiar with.\\r\\n\\r\\n* Care and Feeding for Your Character: http:\\/\\/vaxia.org\\/wiki\\/help\\/care-and-feeding-your-character\\r\\n* Vaxia System Walkthrough: http:\\/\\/vaxia.org\\/quizzes\\/new-player-system-walkthrough\\r\\n* Beginner\\u0027s Guide to Roleplaying: http:\\/\\/vaxia.org\\/wiki\\/help\\/beginners-guide-roleplaying\\r\\n* Beginner\\u0027s Guide to Sessions: http:\\/\\/vaxia.org\\/wiki\\/help\\/beginners-guide-sessions\\r\\n\\r\\nThere are some relevant site policies you want want to look over as well.\\r\\n\\r\\n* Code of Conduct: http:\\/\\/vaxia.org\\/wiki\\/site-policies\\/code-conduct\\r\\n* Harassment Policy: http:\\/\\/vaxia.org\\/wiki\\/site-policies\\/harassment-policy\\r\\n* Real Life Harm: http:\\/\\/vaxia.org\\/wiki\\/site-policies\\/real-life-harm\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "8" : "8" } } } }
      ]
    }
  }');
  $items['items_notify_player_when_char_disapproved'] = entity_import('rules_config', '{ "items_notify_player_when_char_disapproved" : {
      "LABEL" : "Notify player when char disapproved",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Characters" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet" } }
          }
        },
        { "NOT user_is_blocked" : { "account" : [ "node:author" ] } },
        { "workflow_check_transition" : {
            "node" : [ "node" ],
            "old_state" : { "value" : { "3" : "3" } },
            "new_state" : { "value" : { "2" : "2" } }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] Your new character needs changes made",
            "message" : "Your character, [node:title], has NOT been approved and is NOT ready to play, because there are some remaining changes that need to be made.\\r\\n\\r\\nYour character was disapproved with the following notes: [node:workflow-current-state-log-entry]\\r\\n\\r\\nPlease review the notes for your item (found under the \\u0022Workflow\\u0022 tab) and address any concerns noted there before resubmitting. You may contact the evaluators ( http:\\/\\/vaxia.org\\/wiki\\/storytellers-and-assistants ) for further assistance in revising your concept.\\r\\n\\r\\nIf you have any questions, please contact: [node:workflow-current-state-updating-user-name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ ",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  return $items;
}
