<?php
/**
 * @file
 * sh_test.rules_defaults.inc
 */

/**
 * Implements hook_default_rules_configuration().
 */
function sh_test_default_rules_configuration() {
  $items = array();
  $items['rules_make_user_eligible_for_sh_on_xp_gain'] = entity_import('rules_config', '{ "rules_make_user_eligible_for_sh_on_xp_gain" : {
      "LABEL" : "Make user eligible for SH on XP gain",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "user_update" : [] },
      "IF" : [
        { "NOT user_has_role" : { "account" : [ "account" ], "roles" : { "value" : { "12" : "12" } } } },
        { "data_is" : {
            "data" : [ "account:field-xp-over-time" ],
            "op" : "\\u003E",
            "value" : "39"
          }
        }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "account" ], "roles" : { "value" : { "12" : "12" } } } },
        { "mail" : {
            "to" : "[user:mail]",
            "subject" : "[Vaxia] You are eligible to become a Storyhost",
            "message" : "Congratulations!\\r\\n\\r\\nYou have been with us for 40 XP worth of posting and RP, and you are now eligible to become a Storyhost. If you\\u0027re interested in joining our Storyhost team please check out the following link:\\r\\n\\r\\nhttp:\\/\\/vaxia.org\\/wiki\\/sh-course\\r\\n\\r\\nEven if you aren\\u0027t interested in the course - you should definitely take the system walk through here: http:\\/\\/vaxia.org\\/quizzes\\/new-player-system-walkthrough so you can make sure your understanding of our system mechanics is up to date.\\r\\n\\r\\nWe\\u0027re happy you\\u0027ve stayed with us, and we hope to share adventures for years to come!\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_response_sh_application'] = entity_import('rules_config', '{ "rules_response_sh_application" : {
      "LABEL" : "Response SH Application",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "storyhost_application" : "storyhost_application" } }
          }
        },
        { "node_is_webform" : { "node" : [ "node" ] } },
        { "user_has_role" : {
            "account" : [ "node:author" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "17" : "17" } }
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_ash_3_approvals($node-\\u003Enid);" } }
      ],
      "DO" : [
        { "webform_close" : { "entity" : [ "node" ], "selected_webform" : { "value" : [] } } },
        { "user_remove_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "17" : "17" } } } },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "9" : "9" } } } },
        { "data_set" : { "data" : [ "node:author:field-took-ash1" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-took-ash2" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-took-ash3" ], "value" : "now" } },
        { "data_set" : { "data" : [ "node:author:field-became-sh" ], "value" : "now" } },
        { "drupal_message" : { "message" : "SH Candidate [node:author:name] has received three approvals and has been promoted to a full Storyhost." } },
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] SH privileges granted",
            "message" : "You have been approved to join the Storyhost\\u0027s on Vaxia. Congratulations!\\r\\n\\r\\nWhen you next see other SH\\u0027s on site, please take a moment to see if any of their stories and your stories can fit together. If you have questions about your sessions, other SHs and World heads are available to answer any questions you may have.\\r\\n\\r\\nWe do ask Storyhosts to regularly run a session once every 3 months, this position is a working volunteer position to serve the needs of the site, so we do need you to fulfill the duties of that role. If you do take an unexpected extended vacation and lose your permissions as a Storyhost you will need to retrain in order to return to Storyhost position. If you know you need to take a vacation, check under your user account for the Vacation button.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] New SH approved",
            "message" : "Storyhost Candidate [user:name] has been promoted to SH!\\r\\n\\r\\nYou are receiving this email because you are one of the Storyhosts.\\r\\n\\r\\nPlease congratulate your new fellow SH when you see them next. Feel free to coordinate with each other if any of their stories and your stories can fit together.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~\\r\\n"
          }
        }
      ]
    }
  }');
  $items['rules_send_feedback_to_sh_from_webform'] = entity_import('rules_config', '{ "rules_send_feedback_to_sh_from_webform" : {
      "LABEL" : "Send feedback to SH from webform",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "9832" } },
        { "node_is_webform" : { "node" : [ "node" ] } }
      ],
      "DO" : [
        { "variable_add" : {
            "USING" : {
              "type" : "text",
              "value" : "\\u003C?php\\r\\n  $results = db_query(\\u0022SELECT wd.data FROM {webform_submitted_data} wd \\u0022 .\\r\\n    \\u0022WHERE wd.nid = 9832 AND wd.cid = 2 ORDER BY sid DESC LIMIT 0,1\\u0022);\\r\\n  foreach ($results as $result) {\\r\\n    return $result-\\u003Edata;\\r\\n  }\\r\\n  return \\u0027\\u0027;\\r\\n?\\u003E"
            },
            "PROVIDE" : { "variable_added" : { "storyhost_name" : "Storyhost name" } }
          }
        },
        { "entity_query" : {
            "USING" : {
              "type" : "user",
              "property" : "name",
              "value" : [ "storyhost-name" ],
              "limit" : "1"
            },
            "PROVIDE" : { "entity_fetched" : { "storyhost" : "Storyhost" } }
          }
        },
        { "mail" : {
            "to" : [ "storyhost:0:mail" ],
            "subject" : "[Vaxia] Storyhost feedback",
            "message" : "The following feedback was received for Storyhost [data:storyhost-value].\\r\\n\\r\\nSubmitted on [site:current-date]\\r\\n\\r\\nThe message we received was:\\r\\n\\r\\n[data:feedback-value]\\r\\n\\r\\nDo to the nature of the anonymous feedback form, we do not have contact information for this user. If the contents of the email are of legal concern such as a report of a crime under U.S. law or a credible threat, please forward the email to the technical administrator so the site owner may review IP logs and decide on a course of action.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_set_sh_character_on_user'] = entity_import('rules_config', '{ "rules_set_sh_character_on_user" : {
      "LABEL" : "Set SH character on User",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "node_insert--character_sheet" : { "bundle" : "character_sheet" } },
      "IF" : [
        { "data_is" : { "data" : [ "node:field-is-storyteller" ], "value" : 1 } }
      ],
      "DO" : [
        { "data_set" : {
            "data" : [ "node:author:field-storyhost-character" ],
            "value" : [ "node" ]
          }
        },
        { "entity_save" : { "data" : [ "node:author" ] } },
        { "data_set" : { "data" : [ "node:field-realm" ], "value" : "storyhost" } },
        { "workflow_rules_set_state" : {
            "node" : [ "node" ],
            "workflow_state" : { "value" : { "4" : "4" } },
            "workflow_comment" : "Storyhost characters are auto approved"
          }
        }
      ]
    }
  }');
  $items['rules_sh_general_expire'] = entity_import('rules_config', '{ "rules_sh_general_expire" : {
      "LABEL" : "SH general expire",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "OR" : [
            { "data_is" : {
                "data" : [ "user:field-took-ash1" ],
                "op" : "\\u003C",
                "value" : {
                  "select" : "site:current-date",
                  "date_offset" : { "value" : -31104000 }
                }
              }
            },
            { "data_is" : {
                "data" : [ "user:field-took-ash2" ],
                "op" : "\\u003C",
                "value" : {
                  "select" : "site:current-date",
                  "date_offset" : { "value" : -31104000 }
                }
              }
            }
          ]
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "15" : "15" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] Your SH privileges have expired",
            "message" : "You are receiving this email because it has been at least a year since you passed ASH Test One and ASH Test Two.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that SH\\u0027s retake these tests regularly so to keep your skills sharp and consistent with the rest of the team. Over time personal style in ruling can deviate and the longer the time the more so, hence the refresher.\\r\\n\\r\\nAs soon as you retake both ASH Test One and ASH Test Two you will be re-enabled automatically as a SH.\\r\\n\\r\\nASH Test 1: http:\\/\\/vaxia.org\\/content\\/ash-test-1-story-hosting-basics\\r\\nASH Test 2: http:\\/\\/vaxia.org\\/content\\/ash-test-2-renewing-shs\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4" } },
            "subject" : "[Vaxia] A SH privileges have expired",
            "message" : "[user:name] is up for SH renewal because it has been at least a year since they passed ASH Test One and ASH Test Two.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that SH\\u0027s retake these tests regularly so to keep skills sharp and consistent with the rest of the team. Over time personal style in ruling can deviate, and the longer the time the more so, hence the refresher.\\r\\n\\r\\nAs soon as [user:name] retakes both ASH Test One and ASH Test Two [user:name] will be re-enabled automatically as a SH.\\r\\n\\r\\nASH Test 1: http:\\/\\/vaxia.org\\/content\\/ash-test-1-story-hosting-basics\\r\\nASH Test 2: http:\\/\\/vaxia.org\\/content\\/ash-test-2-renewing-shs\\r\\n\\r\\nThis email is just a courtesy to let you know about the temporary change in status.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_general_expire_warning'] = entity_import('rules_config', '{ "rules_sh_general_expire_warning" : {
      "LABEL" : "SH general expire warning",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "php", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "OR" : [
            { "data_is" : {
                "data" : [ "user:field-took-ash1" ],
                "value" : {
                  "select" : "site:current-date",
                  "date_offset" : { "value" : -28512000 }
                }
              }
            },
            { "data_is" : {
                "data" : [ "user:field-took-ash2" ],
                "value" : {
                  "select" : "site:current-date",
                  "date_offset" : { "value" : -28512000 }
                }
              }
            }
          ]
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] Your SH privileges are up for renewal",
            "message" : "You are receiving this email because it has almost been a year since you passed ASH Test One and ASH Test Two.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that SH\\u0027s retake these tests regularly so to keep your skills sharp and consistent with the rest of the team. Over time personal style in ruling can deviate, and the longer the time the more so. We ask that you take a refresher every year.\\r\\n\\r\\nPlease be sure to retake these tests before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E to avoid losing your permissions.\\r\\n\\r\\nASH Test 1: http:\\/\\/vaxia.org\\/content\\/ash-test-1-story-hosting-basics\\r\\nASH Test 2: http:\\/\\/vaxia.org\\/content\\/ash-test-2-renewing-shs\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4" } },
            "subject" : "[Vaxia] A SH privileges are up for renewal",
            "message" : "[user:name] is up for SH renewal because it has almost been a year since they passed ASH Test One and ASH Test Two.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that SH\\u0027s retake these tests regularly so to keep skills sharp and consistent with the rest of the team.\\r\\n\\r\\n[user:name] needs to retake the ASH tests before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E to avoid losing their permissions.\\r\\n\\r\\nASH Test 1: http:\\/\\/vaxia.org\\/content\\/ash-test-1-story-hosting-basics\\r\\nASH Test 2: http:\\/\\/vaxia.org\\/content\\/ash-test-2-renewing-shs\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_renewal'] = entity_import('rules_config', '{ "rules_sh_renewal" : {
      "LABEL" : "SH Renewal",
      "PLUGIN" : "reaction rule",
      "WEIGHT" : "1",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "15" : "15", "9" : "9" } },
            "operation" : "OR"
          }
        },
        { "OR" : [
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7781" } }
          ]
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash1" ],
            "op" : "\\u003E",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -2592000 } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash2" ],
            "op" : "\\u003E",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -2592000 } }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "15" : "15" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have renewed your SH permissions",
            "message" : "You have renewed their Storyhost permissions by passing ASH Test 1 and ASH Test 2 within the last month.\\r\\n\\r\\nCongratulations!\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9" } },
            "subject" : "[Vaxia] A SH has renewed permissions",
            "message" : "[user:name] has renewed their Storyhost permissions by passing ASH Test 1 and ASH Test 2 - Renewal within the last month.\\r\\n\\r\\nRenewed Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_1_expire'] = entity_import('rules_config', '{ "rules_sh_test_1_expire" : {
      "LABEL" : "SH Test 1 Expire",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash1" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -15552000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been dropped from the ASH program",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test One, nor completed ASH Test Two.\\r\\n\\r\\nYou are still eligible for ASH, but please try to complete your testing promptly when you next apply. You will need to retake ASH Test One: http:\\/\\/vaxia.org\\/content\\/ash-test-1-story-hosting-basics\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] ASH member dropped from the program",
            "message" : "[user:name] has not completed three sessions and ASH Test Two within the time alloted, and has lost all permissions above player as a result.\\r\\n\\r\\nYou are receiving this email because you are eligible as a Storyhost mentor, and need to be aware of the change.\\r\\n\\r\\nFor whatever reason this player was not ready to fulfill duties as an ASH yet. They are still eligable to become an ASH again when they retake ASH Test One, but a Storyhost mentor should check with this player to determine why they were not able to complete the test earlier.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_1_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_1_mark_pass" : {
      "LABEL" : "SH Test 1 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } } ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test One." } }
      ]
    }
  }');
  $items['rules_sh_test_1_response'] = entity_import('rules_config', '{ "rules_sh_test_1_response" : {
      "LABEL" : "SH Test 1 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "workflow_rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "13" : "13", "10" : "10", "9" : "9" } },
            "operation" : "OR"
          }
        }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] A new SH applicant has completed ASH Test One",
            "message" : "A player had passed ASH Test One!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run three sessions with an SH mentor on hand to handle the numbers within the next six  months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions. The new ASH does *not* have powers to view sheets or assign XP. The mentor will need to do that for them.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test One",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test One. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Two, you need to practice some of what you\\u0027ve learned so far. You must run three sessions with an SH mentor on hand to handle the numbers within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The SH does not need to be the same SH for each of these sessions, so please feel free to contact any of them to coordinate your sessions.\\r\\n\\r\\nOnce you are done with your three sessions, take ASH Test Two: http:\\/\\/vaxia.org\\/content\\/ash-test-2-ruling\\r\\n\\r\\nWelcome aboard, we\\u0027re looking forward to working with you.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "workflow_rules_set_state" : {
            "node" : [ "user:field-storyhost-character" ],
            "workflow_state" : { "value" : { "4" : "4" } },
            "workflow_comment" : "Set Storyhost character - if exists - to approved on passing ASH 1"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_expire'] = entity_import('rules_config', '{ "rules_sh_test_2_expire" : {
      "LABEL" : "SH Test 2 Expire",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "10" : "10", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash2" ],
            "op" : "\\u003C",
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -15552000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "data_set" : { "data" : [ "user:field-took-ash1" ], "value" : "now" } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been downgrades in the ASH program",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test Two, nor completed your ASH testing.\\r\\n\\r\\nYou are still eligible for ASH, but please try to complete your testing promptly when you next apply. You will need to retake ASH Test Two to continue: http:\\/\\/vaxia.org\\/content\\/ash-test-2-ruling\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] ASH member downgraded in program",
            "message" : "[user:name] has not completed five sessions and ASH Test Final within the time allotted, and been downgraded to ASH One as a result. This player will need to retake ASH Test Two.\\r\\n\\r\\nYou are receiving this email because you are eligible as a Storyhost mentor, and need to be aware of the change.\\r\\n\\r\\nFor whatever reason this player was not ready to fulfill duties as an ASH yet. They are still eligible to become an ASH again when they retake ASH Test Two, but a Storyhost mentor should check with this player to determine why they were not able to complete the test earlier.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~ "
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_2_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_2_mark_pass" : {
      "LABEL" : "SH Test 2 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "OR" : [
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7781" } }
          ]
        }
      ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash2" ], "value" : "now" } },
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test Two." } }
      ]
    }
  }');
  $items['rules_sh_test_2_response'] = entity_import('rules_config', '{ "rules_sh_test_2_response" : {
      "LABEL" : "SH Test 2 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "9" : "9", "10" : "10" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_sessions_ran($user-\\u003Euid, 3);" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "13" : "13" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] An ASH has passed ASH Test Two",
            "message" : "A player had passed ASH Test Two!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts.\\r\\n\\r\\nWhen you\\u0027re done with the champagne and cookies - send him or her a care package and put \\u0027em to work. They must run five sessions within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E. The new ASH has received ASH powers and may now view sheets.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Assistant Storyhost: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test Two",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test Two. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nIn order to proceed to ASH Test Three, you need to practice some of what you\\u0027ve learned so far. You must run five sessions within the next six months before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+6 month\\u0027)); ?\\u003E.\\r\\n\\r\\nWith passing ASH Test Two you are now empowered with the ability to view sheets, assign XP and generally act as a direct SH. Do not abuse this power.\\r\\n\\r\\nOnce you are done with your five sessions, take ASH Test Three: http:\\/\\/vaxia.org\\/content\\/ash-test-3-advanced-story-hosting\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : {
                "10" : "10",
                "17" : "17",
                "9" : "9",
                "14" : "14",
                "21" : "21",
                "4" : "4",
                "3" : "3"
              }
            },
            "subject" : "[Vaxia] [user:name] has passed ASH Test Two",
            "message" : "[user:name] has graduated from ASH 1 to ASH 2!\\r\\n\\r\\nThat means they are now ready to start working with the numbers and ruling on their own. This is also a great point in their development as a Storyhost to give them some feedback for things they should focus on in their next five sessions.\\r\\n\\r\\nPleas take a moment to drop by this form to give your feedback. It is anonymous, so that the new ASH won\\u0027t associate your feedback with you personally.\\r\\n\\r\\nThis sort of feedback is invaluable for their development as a Storyhost, so don\\u0027t forget to tell them what they\\u0027re doing right! That way they know to keep doing that in future sessions.\\r\\n\\r\\nFeedback form: http:\\/\\/vaxia.org\\/content\\/storyhost-feedback?storyhost=[user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['rules_sh_test_3_mark_pass'] = entity_import('rules_config', '{ "rules_sh_test_3_mark_pass" : {
      "LABEL" : "SH Test 3 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "7181" } } ],
      "DO" : [
        { "data_set" : { "data" : [ "user:field-took-ash3" ], "value" : "now" } },
        { "php_eval" : { "code" : "return sh_test_setup_ash_3_save_answers($user, $node);" } }
      ]
    }
  }');
  $items['rules_sh_test_3_reminder_to_approvers'] = entity_import('rules_config', '{ "rules_sh_test_3_reminder_to_approvers" : {
      "LABEL" : "SH Test 3 Reminder to Approvers",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "sh_test" ],
      "ON" : { "overdue_application" : [] },
      "IF" : [
        { "entity_is_of_bundle" : {
            "entity" : [ "node" ],
            "type" : "node",
            "bundle" : { "value" : { "storyhost_application" : "storyhost_application" } }
          }
        }
      ],
      "DO" : [
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia]  An ASH application has been waiting for a week",
            "message" : "A player had passed ASH Test Three, and their application has not yet been approved by three eligible approvers. Approval roles are currently Storyhosts and Evaluators.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to approve new Storyhosts. Three approvers must mark this application before it is accepted and the ASH promoted to SH.\\r\\n\\r\\nPlease take a look and evaluate if you believe this player is ready to become a full Storyhost. If they aren\\u0027t, please be ready to provide guidance and instruction to the ASH to resolve any lingering concerns. You will need to be specific about your concerns so the ASH can address them and improve on them.\\r\\n\\r\\nIf this ASH is not going to be able to pass on this application, then all eligible approvers need to weigh in on what the ASH can do to improve so they may work on weak points for the next application. This application will remain open until all approvers have provided feedback in order to provide the ASH with the greatest chance of passing on the next attempt.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nStoryhost Candidate: [user:name]\\r\\nApplication: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "entity_save" : { "data" : [ "node" ] } }
      ]
    }
  }');
  $items['rules_sh_test_3_response'] = entity_import('rules_config', '{ "rules_sh_test_3_response" : {
      "LABEL" : "SH Test 3 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7181" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "10" : "10" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "17" : "17", "9" : "9" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_sessions_ran($user-\\u003Euid, 7);" } }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "17" : "17" } } } },
        { "entity_create" : {
            "USING" : {
              "type" : "node",
              "param_type" : "storyhost_application",
              "param_title" : "Application: [user:name]",
              "param_author" : [ "user" ]
            },
            "PROVIDE" : { "entity_created" : { "entity_created" : "Created application" } }
          }
        },
        { "entity_save" : { "data" : [ "entity-created" ], "immediate" : 1 } },
        { "data_set" : {
            "data" : [ "user:field-ash-3-application" ],
            "value" : [ "entity-created" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14" } },
            "subject" : "[Vaxia] An ASH has passed ASH Test Three",
            "message" : "A player had passed ASH Test Three!\\r\\n\\r\\nYou are receiving this email because you are one of the people available to approve new Storyhosts. Three approvers must mark this application before it is accepted and the ASH promoted to SH.\\r\\n\\r\\nThis ASH is ready for the final test. A Storyhost application has been created with the answers they provided for ASH Test Three. Please take a look and evaluate if you believe this player is ready to become a full Storyhost. If they aren\\u0027t, please be ready to provide guidance and instruction to the ASH to resolve any lingering concerns. You will need to be specific about your concerns so the ASH can address them and improve on them.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nStoryhost Candidate: [user:name]\\r\\nApplication: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed ASH Test Three",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed ASH Test Three. You are on your way to becoming a full Storyhost on Vaxia.\\r\\n\\r\\nA Storyhost application has been created with the answers you provided for ASH Test Three. The current SHs will be reviewing your answers shortly. Three of the current SHs need to approve your application at which point your account will be marked as a full SH. Please give the SHs time to review. If any of them have any questions or concerns they will contact you and ask for further clarification.\\r\\n\\r\\nYour application can be seen here: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "drupal_message" : { "message" : "Your answers to ASH Test Three have been marked on your application. Please give our SHs time to review them." } },
        { "php_eval" : { "code" : "return sh_test_setup_approval_form($user, $node, $entity_created);" } }
      ]
    }
  }');
  $items['rules_sh_test_4_response'] = entity_import('rules_config', '{ "rules_sh_test_4_response" : {
      "LABEL" : "SH Test 4 Response",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "9359" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "12" : "12", "9" : "9" } }
          }
        },
        { "NOT user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } }
      ],
      "DO" : [
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14" } },
            "subject" : "[Vaxia] A SH has passed the Evaluator Test",
            "message" : " A SH has passed the Evaluator Test!\\r\\n\\r\\nYou are receiving this email because you are on the Storyhost or Evaluator team.\\r\\n\\r\\nThis message is to let you know a new evaluator is on duty. Evaluators review characters, items and other objects in the system with an eye towards overall game and player balance. We can always use more evaluators, so if you aren\\u0027t one yet - please consider taking the training and test to become one. The more eyes we have on the system the more balanced and secure it is.\\r\\n\\r\\nIf you are not comfortable with being a storyhost or evaluator, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Evaluator: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have passed the Evaluator Test",
            "message" : "Congratulations!\\r\\n\\r\\nYou are receiving this email because you have passed the Evaluator Test.\\r\\n\\r\\nEvaluators review characters, items and other objects in the system with an eye towards overall game and player balance. The more eyes we have on the system the more balanced and secure it is. Do not abuse this power.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['rules_update_expire_on_eval'] = entity_import('rules_config', '{ "rules_update_expire_on_eval" : {
      "LABEL" : "Update expire on eval",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "workflow_rules" ],
      "ON" : { "workflow_state_changed" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "character_sheet" : "character_sheet", "items" : "items" } }
          }
        },
        { "NOT data_is" : { "data" : [ "node:author:uid" ], "value" : [ "site:current-user:uid" ] } },
        { "data_is" : { "data" : [ "node:created" ], "op" : "\\u003E", "value" : "-7 days" } },
        { "workflow_check_state" : {
            "node" : [ "node" ],
            "workflow_state" : { "value" : { "4" : "4", "15" : "15" } }
          }
        },
        { "data_is" : {
            "data" : [ "node:author:field-powers-expire" ],
            "op" : "\\u003C",
            "value" : "+6 months"
          }
        }
      ],
      "DO" : [
        { "data_set" : { "data" : [ "node:author:field-powers-expire" ], "value" : "+6 months" } }
      ]
    }
  }');
  $items['rules_update_expire_on_session_creation'] = entity_import('rules_config', '{ "rules_update_expire_on_session_creation" : {
      "LABEL" : "Update expire on session creation",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "php" ],
      "ON" : {
        "node_update--session_report" : { "bundle" : "session_report" },
        "node_insert--session_report" : { "bundle" : "session_report" }
      },
      "IF" : [
        { "data_is" : {
            "data" : [ "node:author:field-powers-expire" ],
            "op" : "\\u003C",
            "value" : "+3 months"
          }
        },
        { "data_is" : { "data" : [ "node:created" ], "op" : "\\u003E", "value" : "-3 days" } },
        { "data_is" : { "data" : [ "node:author:uid" ], "value" : [ "site:current-user:uid" ] } },
        { "php_eval" : { "code" : "return sh_test_session_counts($node);" } }
      ],
      "DO" : [
        { "data_set" : { "data" : [ "node:author:field-powers-expire" ], "value" : "+3 months" } }
      ]
    }
  }');
  $items['rules_update_expire_on_session_update'] = entity_import('rules_config', '{ "rules_update_expire_on_session_update" : {
      "LABEL" : "Update expire on session update",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "Staff" ],
      "REQUIRES" : [ "rules", "php" ],
      "ON" : { "node_update--session_report" : { "bundle" : "session_report" } },
      "IF" : [
        { "data_is" : {
            "data" : [ "node:author:field-powers-expire" ],
            "op" : "\\u003C",
            "value" : "+3 months"
          }
        },
        { "data_is" : { "data" : [ "node:created" ], "op" : "\\u003E", "value" : "-3 days" } },
        { "data_is" : { "data" : [ "node:author:uid" ], "value" : [ "site:current-user:uid" ] } },
        { "php_eval" : { "code" : "return sh_test_session_counts($node);" } }
      ],
      "DO" : [
        { "data_set" : { "data" : [ "node:author:field-powers-expire" ], "value" : "+3 months" } }
      ]
    }
  }');
  $items['rules_warn_at_sh_test_if_not_eligable'] = entity_import('rules_config', '{ "rules_warn_at_sh_test_if_not_eligable" : {
      "LABEL" : "Warn at SH Test if not Eligable",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules" ],
      "ON" : { "node_view--quiz" : { "bundle" : "quiz" } },
      "IF" : [
        { "NOT user_has_role" : {
            "account" : [ "site:current-user" ],
            "roles" : { "value" : { "12" : "12" } }
          }
        },
        { "OR" : [
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7037" } },
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7050" } },
            { "data_is" : { "data" : [ "node:nid" ], "value" : "7181" } }
          ]
        }
      ],
      "DO" : [
        { "drupal_message" : { "message" : "You are not yet eligible to become a Storyhost. We want to make sure that potential Storyhosts have experience with the community and the system before they start running sessions. We measure that by keeping track of how much XP you\\u0027ve earned across all of your characters. You need 40 XP to become eligible to become a SH. You currently have [site:current-user:field-xp-over-time] recorded XP. You may still take this quiz as a practice run." } }
      ]
    }
  }');
  $items['sh_test_evaluator_renewal'] = entity_import('rules_config', '{ "sh_test_evaluator_renewal" : {
      "LABEL" : "Evaluator Renewal",
      "PLUGIN" : "reaction rule",
      "WEIGHT" : "1",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "20" : "20", "14" : "14" } },
            "operation" : "OR"
          }
        },
        { "data_is" : { "data" : [ "node:nid" ], "value" : "9359" } },
        { "data_is" : {
            "data" : [ "user:field-took-eval-test" ],
            "op" : "\\u003C",
            "value" : { "select" : "site:current-date", "date_offset" : { "value" : -2592000 } }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "20" : "20" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have renewed your Evaluator permissions",
            "message" : "You have renewed you Evaluator permissions by passing ASH Test 4 - Item and Character Evaluation within the last month.\\r\\n\\r\\nCongratulations!\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14" } },
            "subject" : "[Vaxia] An Evaluator has renewed permissions",
            "message" : "[user:name] has renewed their Evaluator permissions by passing ASH Test 4 - Item and Character Evaluation within the last month.\\r\\n\\r\\nRenewed Evaluator: [user:name]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['sh_test_response_sh_application_all_reviewers_in'] = entity_import('rules_config', '{ "sh_test_response_sh_application_all_reviewers_in" : {
      "LABEL" : "Response SH Application - All reviewers in",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "webform_rules", "php" ],
      "ON" : { "webform_rules_submit" : [] },
      "IF" : [
        { "node_is_of_type" : {
            "node" : [ "node" ],
            "type" : { "value" : { "storyhost_application" : "storyhost_application" } }
          }
        },
        { "node_is_webform" : { "node" : [ "node" ] } },
        { "user_has_role" : {
            "account" : [ "node:author" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "17" : "17" } }
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_ash_3_responses($node-\\u003Enid);" } }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "node:author:mail" ],
            "subject" : "[Vaxia] All current SH approvers have ruled on your application",
            "message" : "All current SH approvers have ruled on your application to join the Storyhosts.\\r\\n\\r\\nPlease take a moment to look at your application and review any responses you may have received. If you have questions about your sessions, other SHs and World heads are available to answer any questions you may have.\\r\\n\\r\\nApplication: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14" } },
            "subject" : "[Vaxia] All current SH approvers have ruled on an ASH application",
            "message" : "All current SH approvers have ruled on an application to join the Storyhosts.\\r\\n\\r\\nPlease take a moment to look at the application and review any responses received if the ASH did not receive enough approvals to be promoted to Storyhost. The ASH should have been given specific guidance in order to improve so they may re-apply. If the guidance they have been given is not detailed enough to allow them to be able to pass on their second try, please consult with the reviewing Storyhost to determine what the applicant needs to do to pass on the next application.\\r\\n\\r\\nApplication: [node:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~\\r\\n"
          }
        },
        { "user_add_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "10" : "10" } } } },
        { "user_remove_role" : { "account" : [ "node:author" ], "roles" : { "value" : { "17" : "17" } } } },
        { "drupal_message" : { "message" : "The SH Candidate has been notified and sent a link to review the feedback given." } }
      ]
    }
  }');
  $items['sh_test_rules_sh_test_4_mark_pass'] = entity_import('rules_config', '{ "sh_test_rules_sh_test_4_mark_pass" : {
      "LABEL" : "SH Test 4 Mark Pass",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [ { "data_is" : { "data" : [ "node:nid" ], "value" : "9359" } } ],
      "DO" : [
        { "drupal_message" : { "message" : "Congratulations, you have passed the ASH Test Four \\/ Evaluation Test." } },
        { "data_set" : { "data" : [ "user:field-took-eval-test" ], "value" : "now" } }
      ]
    }
  }');
  $items['sh_test_sh_test_1_expire_warning'] = entity_import('rules_config', '{ "sh_test_sh_test_1_expire_warning" : {
      "LABEL" : "SH Test 1 Expire Warning",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "13" : "13", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash1" ],
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -12960000 }
            }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You are nearing your ASH program deadline",
            "message" : "You are receiving this email because you have not run your three sessions since you passed ASH Test One, nor completed ASH Test Two.\\r\\n\\r\\nWhen you took ASH Test One you needed to run your sessions by \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E.\\r\\n\\r\\nOnce you are done with your five sessions, take ASH Test Twi: http:\\/\\/vaxia.org\\/content\\/ash-test-2-ruling\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion, so please let us know if you are having trouble.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['sh_test_sh_test_2_expire_warning'] = entity_import('rules_config', '{ "sh_test_sh_test_2_expire_warning" : {
      "LABEL" : "SH Test 2 Expire Warning",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "8" : "8", "10" : "10", "12" : "12" } }
          }
        },
        { "data_is" : {
            "data" : [ "user:field-took-ash2" ],
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -12960000 }
            }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You are nearing your ASH program deadline",
            "message" : "You are receiving this email because you have not run your five sessions since you passed ASH Test Two, nor completed ASH Test Three.\\r\\n\\r\\nWhen you took ASH Test Two you needed to run your sessions by \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E.\\r\\n\\r\\nOnce you are done with your five sessions, take ASH Test Three: http:\\/\\/vaxia.org\\/content\\/ash-test-3-advanced-story-hosting\\r\\n\\r\\nWe are always glad to help a candidate complete their tests in a timely fashion, so please let us know if you are having trouble.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['sh_test_sh_test_3_response_low_no_sh_population'] = entity_import('rules_config', '{ "sh_test_sh_test_3_response_low_no_sh_population" : {
      "LABEL" : "SH Test 3 Response - low\\/no SH population",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "quiz_rules" ],
      "ON" : { "quiz_rules_quiz_passed" : [] },
      "IF" : [
        { "data_is" : { "data" : [ "node:nid" ], "value" : "7181" } },
        { "user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "12" : "12", "8" : "8", "10" : "10" } }
          }
        },
        { "NOT user_has_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "17" : "17", "9" : "9" } },
            "operation" : "OR"
          }
        },
        { "php_eval" : { "code" : "return sh_test_check_sessions_ran($user-\\u003Euid, 7);" } },
        { "NOT php_eval" : { "code" : "return sh_test_check_starvation_mode();" } }
      ],
      "DO" : [
        { "user_remove_role" : {
            "account" : [ "user" ],
            "roles" : { "value" : { "10" : "10", "17" : "17" } }
          }
        },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4", "3" : "3" } },
            "subject" : "[Vaxia] An ASH has been automatically advanced to SH",
            "message" : "A player had passed ASH Test Three and been automatically advanced to Storyhost status due to a critical shortage of Storyhosts available at this time.\\r\\n\\r\\nYou are receiving this email because you are one of the people available to mentor new Storyhosts. We are running under a critical number of Storyhosts and cannot afford to readily reject anyone who has put in the work of running eight full sessions already. At this point in time there are three or less (possibly zero) Storyhosts on the site.\\r\\n\\r\\nA Storyhost application has been created with the answers they provided for ASH Test Three. Please take a look and evaluate if you believe this player is likely to be a problem as a full Storyhost. If they aren\\u0027t, please be ready to provide guidance and instruction to resolve any lingering concerns.\\r\\n\\r\\nIf you are not comfortable with being a mentor at all, please speak to any of the current heads to update your access privileges.\\r\\n\\r\\nNew Storyhost: [user:name]\\r\\nApplication: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] You have been automatically advanced to SH",
            "message" : "[Vaxia] You have been automatically advanced to SH\\r\\n\\r\\nCongratulations!\\r\\n\\r\\nYou have passed ASH Test Three and been automatically advanced to Storyhost status due to a critical shortage of Storyhosts available at this time.\\r\\n\\r\\nWe are running under a critical number of Storyhosts and cannot afford to readily reject anyone who has put in the work of running eight full sessions already. At this point in time there are three or less (possibly zero) Storyhosts on the site. Please keep in mind, even though we have a shortage of Storyhosts you are still held to the standards of what we expect out of a Storyhost - please do not abuse the trust extended to you with this automatic advancement. If we do detect an abuse has occurred, we will remove the rank.\\r\\n\\r\\nA Storyhost application has been created with the answers you provided for ASH Test \\r\\n\\r\\nYour application can be seen here: [entity-created:url]\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        }
      ]
    }
  }');
  $items['vaxia_accounts_sh_eval_expire'] = entity_import('rules_config', '{ "vaxia_accounts_sh_eval_expire" : {
      "LABEL" : "SH Eval Expire",
      "PLUGIN" : "reaction rule",
      "ACTIVE" : false,
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } },
        { "data_is" : {
            "data" : [ "user:field-took-eval-test" ],
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -31104000 }
            }
          }
        }
      ],
      "DO" : [
        { "user_remove_role" : { "account" : [ "user" ], "roles" : { "value" : { "9" : "9" } } } },
        { "user_add_role" : { "account" : [ "user" ], "roles" : { "value" : { "20" : "20" } } } },
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] Your Evaluator privileges have expired",
            "message" : "You are receiving this email because it has been at least a year since you passed ASH Test Four \\/ Eval Test.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that Evaluator retake these tests regularly so to keep your skills sharp and consistent with the rest of the team. Over time personal style in ruling can deviate and the longer the time the more so, hence the refresher.\\r\\n\\r\\nAs soon as you retake ASH Test Four \\/ Eval Test you will be re-enabled automatically as a Evaluator.\\r\\n\\r\\nEvaluator Test: http:\\/\\/vaxia.org\\/content\\/ash-test-4-item-and-character-evaluation\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "4" : "4" } },
            "subject" : "[Vaxia] An Evaluator privileges have expired",
            "message" : "[user:name] is up for Evaluator renewal because it has been at least a year since they passed ASH Test Four.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that SH\\u0027s retake these tests regularly so to keep skills sharp and consistent with the rest of the team. Over time personal style in ruling can deviate, and the longer the time the more so, hence the refresher.\\r\\n\\r\\nAs soon as [user:name] retakes ASH Test Four [user:name] will be re-enabled automatically as an Evaluator.\\r\\n\\r\\nASH Test 4: http:\\/\\/vaxia.org\\/content\\/ash-test-4-item-and-character-evaluation\\r\\n\\r\\nThis email is just a courtesy to let you know about the temporary change in status.\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  $items['vaxia_accounts_sh_eval_expire_warning'] = entity_import('rules_config', '{ "vaxia_accounts_sh_eval_expire_warning" : {
      "LABEL" : "SH Eval Expire Warning",
      "PLUGIN" : "reaction rule",
      "OWNER" : "rules",
      "TAGS" : [ "SH Test" ],
      "REQUIRES" : [ "rules", "php", "user_stats" ],
      "ON" : { "user_stats_day_older" : [] },
      "IF" : [
        { "user_has_role" : { "account" : [ "user" ], "roles" : { "value" : { "14" : "14" } } } },
        { "data_is" : {
            "data" : [ "user:field-took-eval-test" ],
            "value" : {
              "select" : "site:current-date",
              "date_offset" : { "value" : -28512000 }
            }
          }
        }
      ],
      "DO" : [
        { "mail" : {
            "to" : [ "user:mail" ],
            "subject" : "[Vaxia] Your Evaluator privileges are up for renewal",
            "message" : "You are receiving this email because it has almost been a year since you passed ASH Test Four \\/ Eval Test.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that Evaluators retake these tests regularly so to keep your skills sharp and consistent with the rest of the team. Over time personal style in ruling can deviate, and the longer the time the more so. We ask that you take a refresher every year.\\r\\n\\r\\nPlease be sure to retake these tests before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E to avoid losing your permissions.\\r\\n\\r\\nEvaluator Test: http:\\/\\/vaxia.org\\/content\\/ash-test-4-item-and-character-evaluation\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~",
            "language" : [ "" ]
          }
        },
        { "mail_to_users_of_role" : {
            "roles" : { "value" : { "9" : "9", "14" : "14", "4" : "4" } },
            "subject" : "[Vaxia] An Evaluators privileges are up for renewal",
            "message" : "[user:name] is up for Evaluator renewal because it has almost been a year since they passed ASH Test Four \\/ Eval Test.\\r\\n\\r\\nJust like getting a driver\\u0027s license, we ask that Evaluators retake these tests regularly so to keep skills sharp and consistent with the rest of the team.\\r\\n\\r\\n[user:name] needs to retake the Evaluator test before \\u003C?php print date(\\u0027m\\/d\\/Y\\u0027, strtotime(\\u0027+1 month\\u0027)); ?\\u003E to avoid losing their permissions.\\r\\n\\r\\nEvaluator Test : http:\\/\\/vaxia.org\\/content\\/ash-test-4-item-and-character-evaluation\\r\\n\\r\\n~~~~~~\\r\\nThis email was automatically generated by vaxia.org.\\r\\nYou are receiving this email as part of your membership at vaxia.org.\\r\\nDo not reply this this email, it is not a monitored account and messages will not be received by a human.\\r\\n~~~~~~"
          }
        }
      ]
    }
  }');
  return $items;
}
