<?php
/**
 * @file
 * Code for the Item helper in scene ruling.
 */

/**
 * Implements hook_scene_record_goal_info.
 */
function item_helper_scene_record_goal_info() {
  return array(
    '_item_helper_calculate_results' => array(
      'label'  => 'A running total for item creation.',
      'type' => array('item'),
    ),
  );
}

/**
 * Scene results callback function.
 */
function _item_helper_calculate_results($comment, &$context) {
  $message_items = array();
  // Grab rolls and start calculations.
  if (!empty($dice_rolls)) {
    $difficulty = !empty($context['diff']) ? $context['diff'] : 25;
    // Set item values.
    if ($diff != 25) {
      $pp_needed_per_point = (1 + (($diff - 40) / 10) ) * 25;
      $points_built_max = (1 + (($diff - 40) / 10) ) * 5;
      $points_built_primary = floor($context['ongoing']['_ruling']['PPs'] / $pp_needed_per_point);
      $points_built_secondary = floor($context['ongoing']['_ruling']['PPs'] / ($pp_needed_per_point * 1.5));
      $points_built_skills= floor($context['ongoing']['_ruling']['PPs'] / ($pp_needed_per_point * 0.75));
    }
    // More messages.
    if ($diff != 25) {
      $message_items[] = '<b>Bonus points for primary stats: ' . $points_built_primary . '</b>';
      $message_items[] = '<b>Bonus points for secondary stats: ' . $points_built_secondary . '</b>';
      $message_items[] = '<b>Bonus points for skills: ' . $points_built_skills . '</b>';
      $message_items[] = '<b>Max points at this difficulty: ' . $points_built_max . '</b>';
      $message_items[] = '<b>PP effect: ' . number_format($context['ongoing']['_ruling']['PPs'], 2) . '</b>';
    }
    else {
      $message_items[] = '<b>PP generated for enchanting one time use: ' . number_format($context['ongoing']['_ruling']['PPs'], 2) . '</b>';
      $message_items[] = '<b>PP generated for enchanting 3 uses: ' . floor($context['ongoing']['_ruling']['PPs'] / 3) . '</b>';
      $message_items[] = '<b>PP generated for enchanting once a day: ' . floor($context['ongoing']['_ruling']['PPs'] / 50) . '</b>';
      $message_items[] = '<b>PP generated for enchanting at will: ' . floor($context['ongoing']['_ruling']['PPs'] / 150) . '</b>';
    }
  }
  return $message_items;
}